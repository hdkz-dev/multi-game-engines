# 意思決定記録 (Decision Log)

## [ADR-001] モノリポ構成の採用
- **決定**: npm workspaces を使用したモノリポ構成を採用。
- **理由**: Core と複数の Adapter 間での型定義の共有を容易にし、原子的な変更（Atomic Commits）を可能にするため。

## [ADR-002] 非同期ストリームに AsyncIterable を採用
- **決定**: 思考状況の配信に RxJS 等のライブラリではなく、標準の AsyncIterable を採用。
- **理由**: フレームワーク非依存を徹底し、依存関係を最小化しつつ、現代の JS で直感的な非同期処理を実現するため。

## [ADR-003] 探索キャンセルに AbortSignal を採用
- **決定**: 独自メソッドではなく `AbortSignal` を使用。
- **理由**: 他の Web API との親和性を高め、標準的なキャンセルパターンを確立するため。

## [ADR-004] メッセージの i18n 化
- **決定**: ロード進捗やエラーに構造化された `II18nMessage` を採用。
- **理由**: OSS ライブラリとして、あらゆる言語のアプリケーションで利用可能にし、開発者が自由に翻訳を適用できるようにするため。

## [ADR-005] 実行環境の機能検知 (Capability Detection)
- **決定**: `ICapabilities` を定義し、起動時に環境を診断する。
- **理由**: OPFS や WebNN などの最新 API を最大限活用しつつ、レガシーな環境でも安定して動作させるため。

## [ADR-007] 自己修復 (Self-Healing) 機構の導入
- **決定**: エンジンのクラッシュ検知と自動再起動プロセスを設計に組み込む。
- **理由**: 長時間の検討や、リソースの厳しいモバイル環境での安定性を極限まで高めるため。

## [ADR-008] ミドルウェア・システムの採用
- **決定**: \`use(middleware)\` による通信パイプラインの拡張を可能にする。
- **理由**: コアを修正することなく、将来のあらゆる要件（解析、ロギング、変換等）に柔軟に対応するため。

## [ADR-009] グローバル・リソース・オーケストレーション
- **決定**: ブリッジレベルでシステム全体の最大スレッド数を管理する。
- **理由**: 複数のエンジンが並行動作する際のデバイス負荷を適切に制御し、UX を保護するため。

## [ADR-010] Branded Types によるドメインモデルの保護
- **決定**: FEN や Move に公称型（Brand）を採用。
- **理由**: 開発時の単純な文字列混用バグをコンパイル時に 100% 排除するため。
