# コネクト4エンジン仕様書: Solver (Fish Line)

## 1. 概要 (Overview)

コネクト4 (Fish Line) は既に完全解析されているゲームです。したがって、ヒューリスティックな探索ではなく、**完全解析ソルバー (Perfect Solver)** を導入することで「神の这一手」を提供できます。

- **参照実装**: Pascal Pons' Connect 4 Solver
- **リポジトリ**: [PascalPons/connect4](https://github.com/PascalPons/connect4)
- **ライセンス**: MIT (またはそれに準ずる)
- **特徴**: ビットボードによる高速計算、転置表を用いたアルファ・ベータ法。

## 2. 実装仕様 (Implementation Details)

### 2.1 WebAssembly ビルド

C++ ソースコードは非常にコンパクト（数ファイル）であり、外部ライブラリ依存も少ないため、Emscripten で容易に Wasm 化可能です。

### 2.2 入出力インターフェース (I/O)

標準入力/標準出力を介したシンプルなテキストプロトコルを使用します。

1.  **入力**: 手順の文字列（列番号 `1`〜`7` の連続）。
    - 例: `4433221` （互いに中央付近に打ち合った手順）
2.  **出力**: 各列に対する評価値（勝/負/引分）または最善手。
    - 例: `4 10` (列4に打つと10手で勝利)

## 3. コマンドシーケンス (Command Sequence)

1.  **状態更新**:
    - `App -> Engine`: `44332` (現在の手順を送る)
2.  **解析実行**:
    - `App -> Engine`: `solve` (または改行を送るだけで解析する実装も可)
3.  **結果受信**:
    - `Engine -> App`: `1: -10, 2: -5, 3: 0, 4: 15 ...`
    - (列1は10手で負け、列3は引き分け、列4は15手で勝ち、等のスコア)

## 4. ユーザー設定項目 (User Settings)

| 設定名       | 推奨値         | 説明                                                                                                            |
| :----------- | :------------- | :-------------------------------------------------------------------------------------------------------------- |
| **Strength** | Perfect / Weak | **Perfect**: 完全読みを行う。<br>**Weak**: ランダム性を持たせるか、探索深度を浅くして人間らしいミスを再現する。 |

## 5. 注意事項 (Notes)

- **先手必勝**: コネクト4は最善を尽くせば先手が必勝であることが証明されています。AIが先手の場合、ユーザーは絶対に勝てないため、**「接待モード (Weak)」** の実装が必須です。
- **計算量**: 序盤は探索空間が広いため、数MBの転置表 (Transposition Table) メモリを割り当てることで応答速度が向上します。
