# リバーシエンジン仕様書: Edax

## 1. 概要 (Overview)

**Edax** は、長年にわたり世界最強の座にあるリバーシ（オセロ）プログラムです。ビットボードによる高速な演算と、高精度な評価関数を特徴としています。
WebAssembly 版を利用することで、ブラウザ上でも「完全読み（終盤の必勝読み）」を含む強力な解析が可能になります。

- **リポジトリ**: [abulmo/edax-reversi](https://github.com/abulmo/edax-reversi)
- **ライセンス**: GPL
- **プロトコル**: GGS (Generic Game Server), NBoard, Custom GTP-like

## 2. 実装仕様 (Implementation Details)

### 2.1 WebAssembly ビルド

Edax は C++ (C11) で記述されており、Emscripten でのコンパイルが可能です。

- **ビルドターゲット**: `lEdax` (ライブラリ版) または `edax` (CLI版)。Web Worker から制御する場合、CLI版の標準入出力をフックするのが最も単純です。
- **データファイル**: `eval.dat` (評価関数) と `book.dat` (定石) が必須です。これらがないと極端に弱くなるか起動しません。

### 2.2 ファイル構成

| ファイル名      | 説明                    |
| :-------------- | :---------------------- |
| `edax.js`       | Emscripten グルーコード |
| `edax.wasm`     | エンジン本体            |
| `data/eval.dat` | 評価係数ファイル        |
| `data/book.dat` | 定石ファイル (必須)     |

## 3. 通信プロトコル (Communication Protocol)

Edax は複数のプロトコルをサポートしていますが、制御のしやすさから **NBoard プロトコル** または **Edax native コマンド** の使用を推奨します。以下は Native コマンドベースの例です（`-n` オプション等で起動）。

### 3.1 コマンド例 (Native Mode)

1.  **初期化・設定**:
    - `App -> Engine`: `level 20` (探索レベル設定: 1-60)
    - `App -> Engine`: `hash-table 12` (ハッシュサイズ 2^12 エントリ)

2.  **対局進行**:
    - `App -> Engine`: `init` (初期盤面)
    - `App -> Engine`: `set F5D6C3...` (盤面指定: 黒番の手番などは盤面情報に含むか別途指定)
    - 詳細な盤面設定コマンドは独自形式のため、USI/UCIのような `position` コマンド相当の実装（ラッパー）が推奨されます。
    - 例: `edax-nboard` モードを使用すると、NBoard プロトコルで対話可能です。

### 3.2 NBoard プロトコル (推奨)

NBoard プロトコルを使用すると、既存の GUI との互換性が高まります。

- `App -> Engine`: `nboard 1` (ハンドシェイク)
- `App -> Engine`: `set game ...` (棋譜による盤面設定)
- `App -> Engine`: `go` (思考開始)
- `Engine -> App`: `=== C3` (着手)

## 4. ユーザー設定項目 (User Settings)

| 設定名              | 推奨値   | 説明                                                        |
| :------------------ | :------- | :---------------------------------------------------------- |
| **Level**           | 10 ~ 21  | 探索深度/レベル。Lv21以上は思考時間が長い。Lv60で完全解析。 |
| **Tasks**           | 1        | スレッド数。                                                |
| **Book Randomness** | Low/High | 定石選択のランダム性。                                      |

## 5. 開発上の注意 (Notes)

- **プロトコルアダプタ**: Edax のネイティブ出力は人間可読なアスキーアート盤面を含むため、プログラムでのパースが困難な場合があります。起動時に `-q` (quiet) オプションを付けるか、NBoard プロトコルモード (`-nboard`) で起動することを強く推奨します。
- **完全解析**: 終盤（残り20手程度〜）になると、Edax は自動的に完全解析モードに入り、勝敗（+2, -6 など）を返します。この挙動をユーザーに「必勝読み中」としてフィードバックするとUXが向上します。
