# 多角的監査最終報告書 (Zenith Tier Audit Report - 2026-02-20)

## 1. 監査概要

拡張アダプターの追加および既存基盤のリファクタリングに対し、CodeRabbit, AI Security SOP, および A11y (WCAG 2.2) の観点から統合的な監査を実施しました。

## 2. 重大指摘事項 (Critical / High)

### 🔴 セキュリティ: SRI 検証の不徹底

- **場所**: `GTPAdapter`, `KingsRowAdapter` 等
- **内容**: 内部で `WorkerCommunicator` を生成する際、SRI ハッシュの検証が必須化されておらず、不正なバイナリの実行リスクが残存している。
- **対策**: `EngineLoader` の検証済みパス以外での Worker 生成を厳格に禁止する。

### 🔴 プライバシー: コンソールログへの局面データ漏洩

- **場所**: `MahjongJSONParser`, `ShogiBoard` 等
- **内容**: エラー発生時、入力された局面文字列（FEN/SFEN/JSON）をそのまま `console.warn` に出力している。悪意のある入力や、局面データに紛れ込んだ個人情報が漏洩するリスクがある。
- **対策**: ログ出力時には局面データをサニタイズ（先頭10文字に制限等）する。

### 🟠 型安全性: ブランド型の不適切な定義

- **場所**: `domain-go`, `domain-shogi` 等
- **内容**: `Move & { __brand: "GOMove" }` のような定義が `Move` 自身のブランドと衝突し、型安全性が形骸化している。
- **対策**: `Move<T>` パターンを `core` で定義し、各ドメインで継承する形に統一。

### 🟠 セキュリティ: コマンド・インジェクション (SFEN)

- **場所**: `USIParser.createSearchCommand`
- **内容**: `options.sfen` がバリデーションなしでコマンド文字列に埋め込まれている。
- **対策**: `ProtocolValidator.assertNoInjection` を適用する。

## 3. 品質・アクセシビリティ指摘事項 (Medium)

### 🟡 A11y: リアルタイム更新の通知欠落

- **内容**: ダッシュボードの統計情報（NPS等）が更新された際、`aria-live` によるスクリーンリーダーへの通知が行われていない。
- **対策**: `StatCard` に `aria-live="polite"` を追加。

### 🟡 国際化: エラーメッセージのハードコード

- **内容**: アダプター内部の `EngineError` メッセージが英語で固定されている。
- **対策**: `packages/i18n` のリソースキーを使用するように移行。

## 4. 結論

プロジェクト全体のアーキテクチャは Zenith Tier の目標に向かって大きく前進していますが、セキュリティとプライバシーに関しては「Refuse by Exception」の原則が末端のアダプターにおいてまだ徹底されていません。これらの項目を最優先で修正することを推奨します。
