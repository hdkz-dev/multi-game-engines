# AI ツール戦略とコスト比較 (AI_TOOLS_STRATEGY.md)

本プロジェクトでは、複数の AI ツールを適材適所で組み合わせる「AI Ensemble 開発」を採用し、人間一人では到達不可能な品質とスピードの両立を目指します。

## 📊 AI ツール一覧とコスト比較

| 領域             | ツール            | 役割                         | コスト (OSS/個人)  | 導入状況    |
| :--------------- | :---------------- | :--------------------------- | :----------------- | :---------- |
| **司令塔**       | **Gemini CLI**    | 創造・実装・ドキュメント     | **無料** (API枠内) | ✅ 導入済   |
| **論理監査**     | **CodeRabbit**    | 行単位の意図・ロジック査読   | **無料** (OSS)     | ✅ 導入済   |
| **静的解析**     | **DeepSource**    | アンチパターン検出・自動修正 | **無料** (OSS)     | ✅ 導入済   |
| **セキュリティ** | **Snyk**          | 脆弱性・依存関係スキャン     | **無料** (Free)    | ✅ 導入済   |
| **可視化**       | **Mermaid.js**    | アーキテクチャの自動図解     | **無料**           | ✅ 導入済   |
| **テスト強化**   | **qodo (Codium)** | エッジケース・テスト生成     | **無料**           | ⏳ 導入中   |
| **性能監視**     | **CodSpeed**      | 継続的ベンチマーク           | **無料** (OSS)     | 🚀 究極提案 |
| **品質サイト**   | **TypeDoc**       | 自己修復型 API ドキュメント  | **無料**           | 🚀 究極提案 |
| **実機検証**     | **Playwright**    | マルチブラウザ E2E 検証      | **無料**           | 🚀 究極提案 |
| **自動運用**     | **Changesets**    | 依存関係・リリースの AI 統制 | **無料**           | ✅ 導入済   |

---

## 🎯 ツール別の詳細役割 (Other Information)

### 1. 創造と構築: Gemini CLI (Jules)

- **強み**: 大規模な文脈理解、複数ファイルにまたがる設計。
- **Agentic Reflection**: 実装後に自ら欠陥を探す「自己反省」ループを標準搭載。

### 2. リリース統制: Changesets

- **役割**: AI が PR ごとに変更の意図を記述した `.changeset/*.md` を生成。
- **効果**: `release-please` よりも明示的な「AI の意思表示」により、意図しない自動リリースを完全に防止。

### 3. 次世代 MCP 連携 (2025-11-25+)

- **安全性**: 全てのツールにアノテーション（`is_destructive` 等）を付与。
- **認可**: OAuth 2.1 に基づく、AI による外部 API 操作の最小権限原則 (PoLP) の適用。

---

## 🚀 究極のベストプラクティスへの昇華 (The Zenith Tier)

### 1. 継続的ベンチマーク (Continuous Benchmarking)

わずかなコード変更による「探索速度 (NPS)」の低下を PR の時点で検知。ゲームエンジンにおいて、パフォーマンスは機能と同等に重要。

### 2. 構造化監査レポート (Structured AI Audit)

実装完了時、AI はテキストだけでなく **`audit_report.json`** を出力。これを CI が読み込み、重大なリスク（`Critical`）が含まれる場合はマージを物理的にブロック。

### 2. 自己修復型ドキュメント (Self-Healing Docs)

TSDoc から API サイトを自動生成し、GitHub Pages へ公開。「ドキュメントと実装の不一致」を物理的に排除。

### 3. ブラウザ・マトリクス検証 (Browser Matrix Testing)

Chromium, Firefox, WebKit の各エンジン上で WASM 動作を自動検証。ブラウザ固有のストレージ制約や命令セットの差異を事前に把握。

### 4. Contract-driven Safety (実行時契約の強制)

`Zod` 等を用い、Worker 通信境界で「値の正当性」をランタイムで保証。コンパイル後の型消去による脆弱性を排除。

---

## 🛡️ 耐障害性とフォールバック戦略 (Resilience & Fallback)

AI ツールの利用制限（レート制限、クレジット不足）が発生した際の、品質を落とさないための代替手段を定義します。

| 制限ツール     | フォールバック手段          | 品質維持のアクション                                       |
| :------------- | :-------------------------- | :--------------------------------------------------------- |
| **Gemini CLI** | ローカル LLM / Web UI       | 別のエージェント（Claude Code 等）を一時的に司令塔へ昇格。 |
| **CodeRabbit** | `pnpm lint` + `tsc`         | 機械的チェックを強化し、手動でのセルフレビューを厳格化。   |
| **Snyk**       | `npm audit` / `osv-scanner` | 標準の CLI ツールによる脆弱性スキャンへ切り替え。          |
| **DeepSource** | ESLint / Prettier           | ローカルの静的解析ルールを CI で強制実行。                 |

---

## 🤖 サブエージェント・アーキテクチャ (Sub-Agent Architecture)

メインエージェントが専門特化した「内部スキル」や「外部エージェント」へタスクを委譲する階層構造を採用。

1.  **Captain**: Gemini CLI (全体指揮)
2.  **Internal Experts**: `codebase_investigator`, `security-auditor` 等
3.  **External Auditors**: CodeRabbit, DeepSource, Snyk 等

---

## 🛠 導入・運用ガイドライン

- **コスト**: 全て **OSS 向け無料枠** を活用。有料化が必要な際は ADR で決定。
- **安全性**: AI モデルの学習に使用されない設定（Opt-out）を優先。
- **優先順位**: 同種の指摘は `DeepSource` (形式) ＞ `CodeRabbit` (意図) の順で処理。
