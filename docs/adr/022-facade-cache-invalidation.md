# ADR-022: ミドルウェア追加時のキャッシュ整合性

## ステータス

承認済み (2026-02-11)

## コンテキスト

`EngineBridge.use()` でグローバルミドルウェアを追加しても、既に生成・キャッシュされていた Facade インスタンス（`EngineFacade`）には新しいミドルウェアが反映されないという設計上の不備がありました。

## 決定

ミドルウェアが追加されるたびに、`EngineBridge` 内にキャッシュされている全ての Facade インスタンスを破棄（`facades.clear()`）することに決定しました。

## 結果

- 次に `getEngine()` を呼び出した際、最新のミドルウェアパイプラインを備えた新しい Facade インスタンスが生成されることが保証されました。
- 動的なロギングの有効化や、パラメータ変換ロジックの注入が即座に反映されるようになりました。
