# ADR 040: Ensemble Adapter Architecture (Swarm-style Multi-Engine Coordination)

## ステータス

提案中 (Proposing)

## コンテキスト

`antigravity-swarm` の思想をゲームエンジン・ブリッジに応用し、複数のエンジンを協調させてより高度な判断を行う仕組みを導入します。
従来の `EngineBridge` は単一のエンジンを選択して使用する形態でしたが、特定の局面において複数のエンジン（例：タクティクスに強いエンジンと、長期戦略に強いエンジン）の意見を統合することで、より精度の高い解析が可能になります。

## 意思決定

`@multi-game-engines/adapter-ensemble` パッケージを新設し、`EnsembleAdapter` を実装します。

1. **複合アダプター設計**: `EnsembleAdapter` は内部に複数の `IEngine` インスタンスを保持します。
2. **戦略インジェクション (Voting Strategies)**: 探索結果の統合アルゴリズムを分離し、`MajorityVote` (多数決), `BestScore` (最善評価値), `WeightedAverage` (重み付き平均) などを選択可能にします。
3. **並列探索管理**: 全てのサブエンジンに対して同時に `search()` を発行し、`AbortSignal` を伝播させて同期を制御します。
4. **プロトコル正規化**: 各サブエンジンの出力（cp, mate, pv 等）を `IEngine` インターフェースの標準形式に正規化した上で統合します。
5. **動的アンサンブル**: `EngineBridge` から動的に構成を受け取り、実行時にアンサンブルメンバー（所属するエンジンたち）を構築します。

## 影響

- **リソース消費**: 複数のエンジンを同時に動かすため、CPU およびメモリの消費が増大します。CapabilityDetector による実行可否の判断が重要になります。
- **解析品質**: 多角的な視点からの解析により、単一エンジンの「見落とし」を軽減できます。
- **拡張性**: 新しい合議アルゴリズムを簡単に追加できるよう、インターフェースを抽象化します。

## コンプライアンス

- **知的財産**: 使用する各エンジンのライセンス要件（GPL 等）がアンサンブル全体に波及するため、適切なライセンス告知の仕組みを維持します。
- **型安全性**: ジェネリクスを用いて、サブエンジンとアンサンブル結果の間で完璧な型パリティを維持します。
