# ADR-027: UI 層のフレームワーク分離と Reactive Core の導入

## ステータス

承認済み (2026-02-15)

## コンテキスト

エンジンの思考状況（PV, 評価値）を表示する UI を作成するにあたり、以下の課題がある：

1. **ベンダーロックインの回避**: 特定のフレームワーク（React等）に依存せず、多様な環境（Vue, Svelte, Vanilla等）で利用可能にしたい。
2. **パフォーマンス**: エンジンからの高頻度なストリームデータ（NPS, 探索深さ等）は毎秒数百回に及ぶ場合があり、安易な再レンダリングはブラウザの負荷を増大させる。

## 決定事項

- **ui-core パッケージの新設**:
  - 特定のフレームワークに依存しないピュアな TypeScript で実装。
  - 状態管理、パース、データの正規化、および「描画スケジューリング（RAF）」を担う。
- **Reactive Engine Store**:
  - 内部状態の更新と外部への通知を分離。
  - `requestAnimationFrame` 同期機能を内蔵し、描画レートをブラウザの再描画周期に自動調整する。
- **Framework Adapters (ui-react, etc.)**:
  - `ui-core` をラップした薄い表現層として提供。React なら Hooks、Vue なら Composables として提供する。

## 結果

- **可用性**: 異なるフレームワーク間でロジックを 100% 共有可能。
- **堅牢性**: 高頻度なデータ更新下でも UI のクラッシュやフリーズを防ぐ構造的な最適化。
- **保守性**: エンジンの通信プロトコル（UCI/USI）の変更や拡張に対して、UI の見た目を修正することなく対応可能。
