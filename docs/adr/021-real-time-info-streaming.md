# ADR-021: 思考状況 (info) のリアルタイム配信インターフェース

## ステータス

承認済み (2026-02-11)

## コンテキスト

探索の最終結果（bestmove）だけでなく、途中の評価値や読み筋を表示したいという要求がありました。以前は AsyncIterator を直接返す設計でしたが、複数の購読者に対応しやすく、かつミドルウェアを適用した後のデータを配信する統一的な仕組みが必要でした。

## 決定

`IEngine` インターフェースに `onInfo(callback)` メソッドを追加しました。
`EngineFacade` 内部で、アダプターが提供する `AsyncIterable` をループで消費し、登録された全てのコールバックへ配信します。この際、配信されるデータには `onInfo` ミドルウェアが適用されます。

## 結果

- ユーザーは `engine.onInfo(info => ...)` というシンプルなイベント駆動形式で、加工済みの思考状況を受け取れるようになりました。
- 購読解除用の関数を返すことで、2026年の Web 標準に即したメモリ管理が可能になりました。
