# ADR-002: 非同期ストリームに AsyncIterable を採用

## ステータス

承認済み

## 日付

2026-01-29

## コンテキスト

エンジンの思考プロセス（`info` コマンド等）は断続的に発生し、複数の情報をストリーミング形式で提供する必要があります。
これまでの Node.js EventEmitter やカスタムリスナーでは、型安全性の確保が難しく、また非同期の反復処理においてボイラープレートが増加する傾向にありました。

## 決定

エンジンからのストリーミング出力の公開 API に `AsyncIterable` を採用します。

### 根拠

1. **標準化**: `for await...of` 文による直感的な反復処理が可能です。
2. **型安全性**: ジェネリクスを用いた `AsyncIterable<T_INFO>` により、ストリーム内の各要素の型を厳密に定義できます。
3. **互換性**: ブラウザと Node.js の両方で標準的にサポートされており、サードパーティライブラリへの依存が不要です。
4. **合成可能性**: Reactive Streams (RxJS) や他のストリーム処理ライブラリへの変換が容易です。

## 結果

- ユーザーは `for await (const info of engine.search(...))` のように簡潔にエンジン出力を処理可能になります。
- アダプター内部の実装（Worker 通信等）が抽象化され、利用側はプロトコル詳細を意識する必要がなくなります。
