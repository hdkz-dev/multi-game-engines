# ADR-033: フレームワーク非依存の盤面コンポーネント (Framework-Agnostic Board UI Components)

## 状況 (Context)

チェスや将棋の思考状況を視覚化するため、高性能かつ再利用性の高い盤面 UI コンポーネントが必要でした。プロジェクトは React、Vue、および Vanilla JS 環境をサポートしており、各フレームワークごとに盤面ロジックを再実装することは保守コストとバグのリスクを高めます。

## 決定 (Decision)

1.  **Web Components (Lit) による実装**:
    - 全ての盤面描画ロジックを `ui-elements` パッケージ内の Web Components として集約します。
    - CSS Grid を活用し、特定のフレームワークに依存しない標準的な HTML 要素として提供します。
2.  **Branded Types による Props 保護**:
    - React/Vue のラッパーコンポーネントにおいて、`fen` (FEN型), `sfen` (SFEN型), `lastMove` (Move型) などのプロパティに Branded Types を強制します。
    - これにより、アプリケーション層から未検証の文字列が盤面コンポーネントに渡されることをコンパイル時に防止します。
3.  **アクセシビリティ (A11y) の動的ローカライズ**:
    - 駒の名称（`aria-label`）を `pieceNames` プロパティを通じて外部（i18nパッケージ等）から注入可能にします。
    - デフォルトでは標準的な英語名称を持ちつつ、日本語環境では「歩」「飛」などの漢字名称を動的に適用します。
4.  **データ属性による観測性の確保**:
    - 各マスに `data-square` 属性（例: `7g`, `e4`）を付与し、自動テストやデバッグ時に座標を容易に特定可能にします。

## 結末 (Consequences)

- **メリット**:
  - UI ロジックの「一箇所での実装、あらゆる場所での利用」を実現。
  - 2026 年標準のアクセシビリティ要件（WCAG 2.2 AA）を全フレームワークで等しく達成。
  - ドメイン知識（FEN/SFENパース）と描画ロジックの関心が分離され、テストが容易。
- **デメリット**:
  - カスタム要素の型定義（`IntrinsicElements`）の管理が必要（React 19 等のバージョン追従）。
  - SSR (Server-Side Rendering) 環境での hydration 時に Lit コンポーネントの初期化を考慮する必要がある。
