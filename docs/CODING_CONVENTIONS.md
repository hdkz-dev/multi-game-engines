# コーディング規約

## 命名規則

- パッケージ: `@multi-game-engines/<name>`
- インターフェース: `I` プレフィックス (例: `IEngine`, `IAdapterOptions`)
- クラス: PascalCase (例: `EngineBridge`)
- ファイル: kebab-case (例: `engine-bridge.ts`)

## TypeScript 規約

- **any の禁止**: 全てのコードにおいて `any` の使用を禁止します。型が不明な場合は `unknown` を使用し、適切に型ガードまたは型アサーションを行ってください。
- **Branded Types の使用**: `FEN` や `Move` 等のドメイン固有の文字列型には Branded Types を使用し、型レベルでの混用バグを防止します。
- **ジェネリクスの順序**: エンジン関連のジェネリクスを使用する場合、以下の順序を厳守してください。
  1. `T_OPTIONS`: 探索設定
  2. `T_INFO`: 思考状況
  3. `T_RESULT`: 探索結果
- **i18n の物理分離**: 多言語リソースは単一パッケージにまとめず、ドメインごとに独立した `i18n-*` パッケージに分離してください。各パッケージは `i18n-core` のロジックを利用します。
- **Zero-Any i18n**: 翻訳データへの動的アクセスが必要な場合は、`DeepRecord` 型（再帰的な Record 型）を定義し、`any` や `as unknown as ReactNode` 等の不安全なキャストを完全に排除してください。

## セキュリティ規約

- **SRI (Subresource Integrity)**: 外部からスクリプトや WASM を動的にロードする場合、必ず SRI による整合性検証を組み込んでください。openssl コマンド等でハッシュを生成し、スクリプト内で照合します。
- **Secure Headers**: Web Worker や CDN からのリスポンスには、適切なセキュリティヘッダー (`Cross-Origin-Opener-Policy`, `Cross-Origin-Embedder-Policy`, `Cross-Origin-Resource-Policy`) を付与し、`SharedArrayBuffer` の安全な使用を保証してください。
- **CORS**: エラーレスポンスを含め、全てのレスポンスに適切な CORS ヘッダーを付与してください。
- **Refuse by Exception (入力拒否)**: ユーザー入力やプロトコルデータに基づく処理を行う場合、サニタイズ（置換して実行）ではなく、不正な文字を検知した時点で即座に例外をスローして処理を拒否してください。特にプロトコル解析やパストラバーサル防止においては、ブラックリスト方式の置換を避け、ホワイトリストまたは厳格な構造チェックを行ってください。
- **Fault-Tolerant Middleware (ミドルウェア絶縁)**: ミドルウェアの実装においては、フック内の処理を `try-catch` で保護し、ミドルウェアのバグや外部サービスの障害が、エンジン本体のメインプロセス（探索やコマンド送出）を道連れに停止させない設計を徹底してください。
- **Structural Safety (循環参照保護)**: 再帰的な構造を持つプロトコルや設定データを扱う場合、`WeakSet` 等を用いて循環参照を検知・拒否し、スタックオーバーフローによるクラッシュを物理的に回避してください。

## ドキュメンテーション規約

- **言語**: ドキュメントおよびコード内のコメントは、原則として**日本語**を使用します。
- **コードとの同期**: ドキュメント内のインターフェース定義や設計記述は、実装 (`types.ts` 等) と常に同期させてください。PR レビュー時に不一致がないか確認します。
- **リンク**: ドキュメント間のリンクは相対パスを使用し、リンク切れがないように動作確認を行ってください。

## インフラ・スクリプト規約

- **Shell Scripts**: シェルスクリプトは `set -euo pipefail` を使用し、エラー時に直ちに停止するようにしてください。外部コマンド (curl 等) にはタイムアウトを設定してください。
- **Docker**: ビルドコンテキストを意識し、必要な設定ファイル (`nginx.conf` 等) が正しくコピーされる記述にしてください。

## フォルダ構造

```text
packages/<name>/
  src/
    index.ts
    types.ts
    __tests__/
  package.json
  tsconfig.json
```
