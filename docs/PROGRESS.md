# プロジェクト進捗状況 (PROGRESS.md)

## 📅 更新日: 2026年2月14日

## 🏆 到達ハイライト (Phase 2 Stage 1 最終洗練完了)

- **究極の自動メモリ管理**: `WeakMap` を活用し、中断やエラー時でもミドルウェアの内部状態が自動的に解放される仕組みを `DefaultTelemetryMiddleware` へ導入。

- **ローカル Quality Gate の確立**: Husky, lint-staged, および強化版 `pre-commit-check.sh` により、コミット時のセキュリティ、型、ビルド、テストの強制パスを実現。

- **セキュリティポリシー (SECURITY.md) の策定**: GitHub の非公開報告機能を活用した脆弱性報告フローを確立。

- **IBaseSearchInfo の抽象化**: `depth` や `score` を Core から排除し、各アダプター固有の型定義へ移行。これにより Core の汎用性と各ゲームエンジンの型表現力を両立。
- **全アダプターの整合性修正**: Stockfish, Katago, Mortal, Yaneuraou, Edax の全アダプターにおいて、Core の型変更に伴う不整合を解消し、型安全性を再構築。
- **Lint 警告の徹底排除**: Declaration Merging 用の空インターフェースやテスト用の特殊な `this` 参照など、全ての Lint エラーと警告を解決。
- **EngineFacade 修正**: `loaderProvider` を注入し、`load()` 時にアダプターへ正しい `IEngineLoader` を渡すよう修正。
- **Zero-Any Architecture 完遂**: `getEngine` のジェネリクス改善、KataGo/Mortal アダプターの型安全な実装、テストコードからの `any` 排除を全て完了。
- **ハンドルベースのライフサイクル**: 共有アダプターを安全に管理するための `ownsAdapter` 方式（ADR-024）を導入。
- **通信効率の最適化**: Parser がオブジェクトを直接返すことでシリアライズコストを削減。
- **テレメトリ統合 (PR #18)**: `DefaultTelemetryMiddleware` による自動パフォーマンス計測と、`IEngineAdapter` への `emitTelemetry` 拡張によるシステム全体の可観測性向上。
- **厳格なセキュリティ拒否 (PR #15/18 最終洗練)**: コマンドインジェクション対策を「サニタイズ」から「例外スローによる拒否」へ格上げ。不正な制御文字を含む入力をプロトコル層で遮断。
- **究極の疎結合アーキテクチャ**: Core パッケージからエンジン固有ロジックを完全排除。アダプターをインポートするだけで型が自動注入されるプラグイン方式を確立。
- **リソース管理のベストプラクティス**: 自動クリーンアップ（Managed Subscriptions, Auto-Revocation）、アトミックなマルチリソース・ロードを標準化。

---

## 📈 現在の状況

### フェーズ 1: コア・フレームワークの実装 (完了)

- [x] **基本設計**: Facade & Adapter パターンの確立。
- [x] **通信基盤**: メッセージバッファリングと AbortSignal 対応。
- [x] **セキュリティ**: SRI 検証 (W3Cマルチハッシュ対応) と COOP/COEP 診断。
- [x] **ストレージ**: OPFS と IndexedDB の自動フォールバック。

### フェーズ 2: 第1段階リリース (進行中)

- [x] **Stockfish 統合**: チェスエンジン対応完了。
- [x] **やねうら王統合**: 将棋エンジン対応完了（startpos対応含む）。
- [x] **品質保証**: 総数 82 ケースのテスト合格、PR #1〜#13 の超深層監査完了。
- [x] **Zero-Any 最終洗練**: コアおよび全アダプター、テストにおける `any` の完全排除。
- [ ] **UI プロトタイプ**: `packages/ui` の新設。

---

## 🚀 次のステップ

1. 思考状況をリアルタイム表示する基本 UI コンポーネント（検討窓など）の開発。
2. 複数のエンジンを一括制御・比較するためのデモダッシュボードの構築。
