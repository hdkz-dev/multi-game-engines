[
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071720",
    "pull_request_review_id": 3822876527,
    "id": 2825071720,
    "node_id": "PRRC_kwDORJ0gd86oYyxo",
    "diff_hunk": "@@ -43,8 +43,19 @@ export class EngineLoader implements IEngineLoader {\n \n     const promise = (async () => {\n       try {\n-        // 2026 Best Practice: HTTPS å¼·åˆ¶ (Security Alert å¯¾å¿œ)\n-        if (config.url.startsWith(\"http://\")) {\n+        // 2026 Best Practice: å®Ÿè¡Œãƒªã‚½ãƒ¼ã‚¹ï¼ˆWorker/WASMï¼‰ã®ã‚ªãƒªã‚¸ãƒ³æ¤œè¨¼\n+        if (config.type === \"worker-js\" || config.type === \"wasm\") {\n+          this.validateWorkerUrl(config.url, engineId);\n+        }",
    "path": "packages/core/src/bridge/EngineLoader.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "f7bd0d9ce82b9c9104ad5ec10db6af0008f88303",
    "user": {
      "login": "gemini-code-assist[bot]",
      "id": 176961590,
      "node_id": "BOT_kgDOCow4Ng",
      "avatar_url": "https://avatars.githubusercontent.com/in/956858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D",
      "html_url": "https://github.com/apps/gemini-code-assist",
      "followers_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "![security-high](https://www.gstatic.com/codereviewagent/security-high-priority.svg) ![high](https://www.gstatic.com/codereviewagent/high-priority.svg)\n\nThe origin validation for engine resources (lines 47-49) only applies when `config.type` is exactly `\"worker-js\"` or `\"wasm\"`. However, the `getMimeType` method (lines 19-32) and the subsequent fetch/blob logic allow any string for `config.type`, defaulting to `\"application/javascript\"`.\n\nAn attacker could provide a different type string (e.g., `\"script\"`) to bypass the `validateWorkerUrl` check. This would allow them to fetch a malicious cross-origin script (provided they also supply the correct SRI hash) and have it loaded as a same-origin Worker via a Blob URL, leading to arbitrary code execution in a Worker context.\n\n**Remediation:** Apply `validateWorkerUrl` to all resource types that can result in an executable MIME type (like `application/javascript` or `application/wasm`), or restrict `config.type` to a strict allow-list of known safe types.",
    "created_at": "2026-02-19T00:25:21Z",
    "updated_at": "2026-02-19T00:25:21Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825071720",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071720"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825071720"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071720/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 47,
    "original_start_line": 47,
    "start_side": "RIGHT",
    "line": 49,
    "original_line": 49,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 9,
    "position": 9,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071726",
    "pull_request_review_id": 3822876527,
    "id": 2825071726,
    "node_id": "PRRC_kwDORJ0gd86oYyxu",
    "diff_hunk": "@@ -126,20 +158,29 @@ export class EngineBridge implements IEngineBridge {\n   getEngine<K extends keyof EngineRegistry>(\n     id: K,\n     strategy?: EngineLoadingStrategy,\n-  ): IEngine<\n-    EngineRegistry[K][\"options\"],\n-    EngineRegistry[K][\"info\"],\n-    EngineRegistry[K][\"result\"]\n-  >;\n+  ): Promise<EngineRegistry[K]>;\n   getEngine<\n-    O extends IBaseSearchOptions,\n-    I extends IBaseSearchInfo,\n-    R extends IBaseSearchResult,\n-  >(id: string, strategy?: EngineLoadingStrategy): IEngine<O, I, R>;\n-  getEngine(\n-    id: string,\n+    O extends IBaseSearchOptions = IBaseSearchOptions,\n+    I extends IBaseSearchInfo = IBaseSearchInfo,\n+    R extends IBaseSearchResult = IBaseSearchResult,\n+  >(\n+    config: IEngineConfig,\n+    strategy?: EngineLoadingStrategy,\n+  ): Promise<IEngine<O, I, R>>;\n+  getEngine<\n+    O extends IBaseSearchOptions = IBaseSearchOptions,\n+    I extends IBaseSearchInfo = IBaseSearchInfo,\n+    R extends IBaseSearchResult = IBaseSearchResult,\n+  >(\n+    idOrConfig: string | IEngineConfig,\n+    strategy?: EngineLoadingStrategy,\n+  ): Promise<IEngine<O, I, R>>;\n+  async getEngine(\n+    idOrConfig: string | IEngineConfig,\n     strategy: EngineLoadingStrategy = \"on-demand\",\n-  ): IEngine<IBaseSearchOptions, IBaseSearchInfo, IBaseSearchResult> {\n+  ): Promise<IEngine<IBaseSearchOptions, IBaseSearchInfo, IBaseSearchResult>> {\n+    const id = typeof idOrConfig === \"string\" ? idOrConfig : idOrConfig.id;",
    "path": "packages/core/src/bridge/EngineBridge.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "f7bd0d9ce82b9c9104ad5ec10db6af0008f88303",
    "user": {
      "login": "gemini-code-assist[bot]",
      "id": 176961590,
      "node_id": "BOT_kgDOCow4Ng",
      "avatar_url": "https://avatars.githubusercontent.com/in/956858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D",
      "html_url": "https://github.com/apps/gemini-code-assist",
      "followers_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "![security-medium](https://www.gstatic.com/codereviewagent/security-medium-priority.svg) ![medium](https://www.gstatic.com/codereviewagent/medium-priority.svg)\n\nThe `getEngine` method (line 179) now accepts an `IEngineConfig` object, enabling dynamic engine instantiation from external configurations. The `id` and `url` properties from this configuration are used by the `EngineLoader` to construct cache keys (e.g., `${engineId}_${config.url}`) without any sanitization.\n\nIf this configuration is derived from untrusted user input, an attacker could use path traversal sequences (e.g., `../`) in the `id` property to manipulate the storage keys. This could allow them to read or overwrite files in the underlying storage (such as the Origin Private File System or a server-side filesystem), potentially leading to data corruption or unauthorized access to other engine resources.\n\n**Remediation:** Sanitize the `id` and `url` properties to remove path traversal characters before using them as storage keys, or use a cryptographic hash of the configuration as the unique cache key.",
    "created_at": "2026-02-19T00:25:21Z",
    "updated_at": "2026-02-19T00:25:21Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825071726",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071726"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825071726"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 220,
    "original_start_line": 179,
    "start_side": "RIGHT",
    "line": 223,
    "original_line": 182,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 108,
    "position": 162,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071730",
    "pull_request_review_id": 3822876527,
    "id": 2825071730,
    "node_id": "PRRC_kwDORJ0gd86oYyxy",
    "diff_hunk": "@@ -26,8 +32,28 @@ const localeData = computed(() => (locale.value === \"ja\" ? locales.ja : locales.\n \n const bridge = getBridge();\n \n+// ã‚¨ãƒ³ã‚¸ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¿æŒ (2026: getEngine ãŒéåŒæœŸã®ãŸã‚)\n+const chessEngine = ref<IEngine<IChessSearchOptions, IChessSearchInfo, IChessSearchResult> | null>(null);\n+const shogiEngine = ref<IEngine<ISHOGISearchOptions, ISHOGISearchInfo, ISHOGISearchResult> | null>(null);\n+const initError = ref<string | null>(null);\n+\n+onMounted(async () => {\n+  if (bridge) {\n+    try {\n+      const [chess, shogi] = await Promise.all([\n+        bridge.getEngine(\"stockfish\"),\n+        bridge.getEngine(\"yaneuraou\"),\n+      ]);\n+      chessEngine.value = chess as IEngine<IChessSearchOptions, IChessSearchInfo, IChessSearchResult>;\n+      shogiEngine.value = shogi as IEngine<ISHOGISearchOptions, ISHOGISearchInfo, ISHOGISearchResult>;",
    "path": "examples/zenith-dashboard-vue/pages/index.vue",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "f7bd0d9ce82b9c9104ad5ec10db6af0008f88303",
    "user": {
      "login": "gemini-code-assist[bot]",
      "id": 176961590,
      "node_id": "BOT_kgDOCow4Ng",
      "avatar_url": "https://avatars.githubusercontent.com/in/956858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D",
      "html_url": "https://github.com/apps/gemini-code-assist",
      "followers_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "![medium](https://www.gstatic.com/codereviewagent/medium-priority.svg)\n\nã“ã®å‹ã‚­ãƒ£ã‚¹ãƒˆ (`as IEngine<...>`) ã¯ä¸è¦ã ã¨æ€ã‚ã‚Œã¾ã™ã€‚\n\n`getEngine` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å´ã§ã®å®£è¨€ä½µåˆï¼ˆdeclaration mergingï¼‰ã«ã‚ˆã‚Šã€`\"stockfish\"` ã‚„ `\"yaneuraou\"` ã¨ã„ã£ãŸå…·ä½“çš„ãªIDã«å¯¾ã—ã¦ã€ã™ã§ã«æ­£ã—ã„å‹ (`Promise<EngineRegistry['stockfish']>` ãªã©) ã‚’è¿”ã™ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚\n\nã“ã®ã‚­ãƒ£ã‚¹ãƒˆã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€PRã®ç›®æ¨™ã§ã‚ã‚‹ã€ŒZero-Any Policyã€ã®åŸå‰‡ã‚’ã‚ˆã‚Šéµå®ˆã—ã€TypeScriptã®å‹æ¨è«–ã«å®Œå…¨ã«ä¾å­˜ã—ãŸã€ã‚ˆã‚Šã‚¯ãƒªãƒ¼ãƒ³ã§å®‰å…¨ãªã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚ã‚‚ã—å‹æ¨è«–ãŒæ­£ã—ãæ©Ÿèƒ½ã—ã¦ã„ãªã„å ´åˆã€`tsconfig.json` ã®è¨­å®šã«å•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§ã‚‚è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚\n\n```\n      chessEngine.value = chess;\n      shogiEngine.value = shogi;\n```\n\n<details>\n<summary>References</summary>\n\n1. ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã‚„Branded Typesã®ä½¿ç”¨ãŒä¸€è²«ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã€å‹å®‰å…¨æ€§ã‚’å®ˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¸è¦ãªå‹ã‚­ãƒ£ã‚¹ãƒˆã¯å‹å®‰å…¨æ€§ã‚’æãªã†å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€å¯èƒ½ãªé™ã‚Šé¿ã‘ã‚‹ã¹ãã§ã™ã€‚ <sup>([link](https://github.com/hdkz-dev/multi-game-engines/blob/main/.gemini/styleguide.md))</sup>\n</details>",
    "created_at": "2026-02-19T00:25:21Z",
    "updated_at": "2026-02-19T00:25:21Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825071730",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071730"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825071730"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071730/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 47,
    "original_start_line": 47,
    "start_side": "RIGHT",
    "line": 48,
    "original_line": 48,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 40,
    "position": 40,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071733",
    "pull_request_review_id": 3822876527,
    "id": 2825071733,
    "node_id": "PRRC_kwDORJ0gd86oYyx1",
    "diff_hunk": "@@ -147,7 +146,11 @@ export class USIParser implements IProtocolParser<\n     if (!data.startsWith(\"bestmove \")) return null;\n \n     const parts = data.split(\" \");\n-    const bestMove = this.createMove(parts[1] || \"\");\n+    const moveStr = parts[1] || \"\";\n+\n+    // none ã¾ãŸã¯ (none) ã®å ´åˆã¯æœ‰åŠ¹ãªæŒ‡ã—æ‰‹ãªã—ã¨ã—ã¦ null ã‚’è¿”ã™ï¼ˆã¾ãŸã¯ç‰¹æ®Šãª Move å‹ã‚’å®šç¾©æ¤œè¨ï¼‰\n+    // ç¾çŠ¶ã¯ MOVE_REGEX ãŒã“ã‚Œã‚‰ã‚’ãƒ‘ã‚¹ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£æ¸ˆã¿ã€‚\n+    const bestMove = this.createMove(moveStr);",
    "path": "packages/adapter-usi/src/USIParser.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "f7bd0d9ce82b9c9104ad5ec10db6af0008f88303",
    "user": {
      "login": "gemini-code-assist[bot]",
      "id": 176961590,
      "node_id": "BOT_kgDOCow4Ng",
      "avatar_url": "https://avatars.githubusercontent.com/in/956858?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D",
      "html_url": "https://github.com/apps/gemini-code-assist",
      "followers_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gemini-code-assist%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "![medium](https://www.gstatic.com/codereviewagent/medium-priority.svg)\n\nã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯ã€Œ`none` ã¾ãŸã¯ `(none)` ã®å ´åˆã« `null` ã‚’è¿”ã™ã€ã¨ç¤ºå”†ã—ã¦ã„ã¾ã™ãŒã€ç¾åœ¨ã®å®Ÿè£…ã§ã¯ `MOVE_REGEX` ãŒã“ã‚Œã‚‰ã®æ–‡å­—åˆ—ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã€`createMove` ã¯æœ‰åŠ¹ãª `Move` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã€çµæœã¨ã—ã¦ `bestmove` ãŒ `\"none\"` ã§ã‚ã‚‹ `ISHOGISearchResult` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¿”ã•ã‚Œã¾ã™ã€‚\n\nã‚‚ã—ã€ŒæŒ‡ã—æ‰‹ãªã—ã€ã‚’ `null` çµæœã¨ã—ã¦æ‰±ã„ãŸã„ã®ã§ã‚ã‚Œã°ã€`bestmove` ã®å€¤ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦æ˜ç¤ºçš„ã« `null` ã‚’è¿”ã™æ–¹ãŒã€å‘¼ã³å‡ºã—å…ƒã§ã®è§£é‡ˆãŒç°¡ç´ åŒ–ã•ã‚Œã€æ„å›³ãŒæ˜ç¢ºã«ãªã‚Šã¾ã™ã€‚\n\n```typescript\n    const moveStr = parts[1] || \"\";\n    if (moveStr === \"none\" || moveStr === \"(none)\") {\n      return null;\n    }\n\n    const bestMove = this.createMove(moveStr);\n```",
    "created_at": "2026-02-19T00:25:21Z",
    "updated_at": "2026-02-19T00:25:21Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825071733",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071733"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825071733"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825071733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 151,
    "original_start_line": 151,
    "start_side": "RIGHT",
    "line": 153,
    "original_line": 153,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 52,
    "position": 52,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083682",
    "pull_request_review_id": 3822891550,
    "id": 2825083682,
    "node_id": "PRRC_kwDORJ0gd86oY1si",
    "diff_hunk": "@@ -0,0 +1,88 @@\n+# Zenith Tier å“è³ªæ¨™æº– (ZENITH_STANDARD.md)\n+\n+æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€`multi-game-engines` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹æœ€é«˜å³°ã®è¨­è¨ˆãƒ»å®Ÿè£…ãƒ»é‹ç”¨åŸºæº–ï¼ˆZenith Tierï¼‰ã‚’å®šç¾©ã—ã¾ã™ã€‚å…¨ã¦ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŠã‚ˆã³ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ä»¥ä¸‹ã®åŸºæº–ã‚’éµå®ˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n+\n+---\n+\n+## ğŸ›ï¸ 1. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸºæº– (Architecture)\n+\n+### 1.1. Zero-Any Architecture\n+\n+- **åŸºæº–**: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã«ãŠã„ã¦ `any` å‹ã®ä½¿ç”¨ã‚’ 100% ç¦æ­¢ã™ã‚‹ã€‚\n+- **å®Ÿè£…**: é€šä¿¡å¢ƒç•Œï¼ˆWorker postMessageï¼‰ã«ãŠã„ã¦ã‚‚ Zod ç­‰ã«ã‚ˆã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ã‚’å¿…é ˆã¨ã—ã€å—ä¿¡ãƒ‡ãƒ¼ã‚¿ã«å³åº§ã« Branded Types ã‚’ä»˜ä¸ã™ã‚‹ã€‚ä¸å¯é¿ãªã‚­ãƒ£ã‚¹ãƒˆã¯ `as unknown as T` ã§ã¯ãªãã€ãƒãƒªãƒ‡ãƒ¼ã‚¿é–¢æ•°ã‚’çµŒç”±ã•ã›ã‚‹ã€‚\n+\n+### 1.2. Protocol-First Abstraction\n+\n+- **åŸºæº–**: ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯ç‰¹å®šã®ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£…ã«ä¾å­˜ã›ãšã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆUCI, USI, GTP ç­‰ï¼‰ã«å¯¾ã—ã¦å®Ÿè£…ã•ã‚Œã‚‹ã€‚\n+- **å®Ÿè£…**: `adapter-uci` ç­‰ã®æ±ç”¨ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã—ã€ã‚¨ãƒ³ã‚¸ãƒ³åã€ãƒã‚¤ãƒŠãƒª URLã€SRI ã¯å¤–éƒ¨è¨­å®šï¼ˆJSON/DIï¼‰ã‹ã‚‰æ³¨å…¥ã™ã‚‹ã€‚\n+\n+### 1.3. Side-Effect Free Core\n+\n+- **åŸºæº–**: `core` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹ã‚’æŒãŸãšã€ç´”ç²‹ãªé–¢æ•°ã¨ã‚¯ãƒ©ã‚¹ã®ã¿ã§æ§‹æˆã•ã‚Œã‚‹ã€‚\n+- **å®Ÿè£…**: `package.json` ã® `sideEffects: false` ã‚’ç¶­æŒã—ã€Tree-shaking ã‚’æœ€å¤§åŒ–ã™ã‚‹ã€‚\n+\n+### 1.4. Domain-Driven Modular Isolation (Pay-as-you-go)\n+\n+- **åŸºæº–**: ç‰¹å®šã®ã‚²ãƒ¼ãƒ ï¼ˆãƒã‚§ã‚¹ã€å°†æ£‹ã€å›²ç¢ç­‰ï¼‰ã«ä¾å­˜ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚„å‹å®šç¾©ã¯ã€å¿…ãšã‚µãƒ–ãƒ‘ã‚¹ï¼ˆä¾‹: `/chess`, `/shogi`ï¼‰ã«éš”é›¢ã—ã€ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ç›´æ¥ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã¯ãªã‚‰ãªã„ã€‚\n+- **å®Ÿè£…**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ `import ... from \"@multi-game-engines/ui-react/shogi\"` ã¨è¨˜è¿°ã—ãŸéš›ã€ãƒã‚§ã‚¹ã‚„å›²ç¢ã®ã‚³ãƒ¼ãƒ‰ãŒ 1 ãƒã‚¤ãƒˆã‚‚ãƒãƒ³ãƒ‰ãƒ«ã«å«ã¾ã‚Œãªã„ã“ã¨ã‚’ç‰©ç†çš„ã«ä¿è¨¼ã™ã‚‹ã€‚\n+\n+---\n+\n+## âš¡ 2. æ€§èƒ½åŸºæº– (Performance)\n+\n+### 2.1. Main-Thread Protection\n+\n+- **åŸºæº–**: ã‚¨ãƒ³ã‚¸ãƒ³ã®æ¼”ç®—ãŠã‚ˆã³é«˜è² è·ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«è§£æã¯å…¨ã¦ Web Worker ã§å®Ÿè¡Œã—ã€ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã® Total Blocking Time (TBT) ã‚’ 50ms æœªæº€ã«ä¿ã¤ã€‚\n+- **å®Ÿè£…**: `ui-core` ã®ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ï¼ˆRAF åŒæœŸï¼‰ã‚’å¿…é ˆã¨ã—ã€UI ã®å†æç”»ã‚’ 60/120fps ã«å›ºå®šã™ã‚‹ã€‚\n+\n+### 2.2. Zero-Latency Experience\n+\n+- **åŸºæº–**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã‚’é–‹å§‹ã™ã‚‹å‰ã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’æº–å‚™ã™ã‚‹ã€‚\n+- **å®Ÿè£…**: `speculative-preloading` æŒ‡é‡ã«åŸºã¥ãã€ãƒ›ãƒãƒ¼æ™‚ã‚„ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã« WASM/é‡ã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å–å¾—ã™ã‚‹ã€‚\n+\n+### 2.3. Multi-Resource Optimization\n+\n+- **åŸºæº–**: å·¨å¤§ãªãƒªã‚½ãƒ¼ã‚¹ï¼ˆNNé‡ã¿ãƒ•ã‚¡ã‚¤ãƒ«ç­‰ï¼‰ã¯ OPFS ã‚’æ´»ç”¨ã—ã€ãƒ¡ãƒ¢ãƒªæ¶ˆè²»ã‚’æœ€å°é™ã«æŠ‘ãˆã‚‹ã€‚\n+- **å®Ÿè£…**: ãƒ¡ãƒ¢ãƒªå±•é–‹ã‚’é¿ã‘ã€ReadableStream ã«ã‚ˆã‚‹ãƒãƒ£ãƒ³ã‚¯å˜ä½ã®å‡¦ç†ã‚’å„ªå…ˆã™ã‚‹ã€‚\n+\n+---\n+\n+## ğŸ› ï¸ 3. é–‹ç™ºä½“é¨“åŸºæº– (Developer Experience)\n+\n+### 3.1. Self-Healing Documentation\n+\n+- **åŸºæº–**: ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆTECHNICAL_SPECS.md, API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ï¼‰ã®ä¹–é›¢ã‚’è¨±å®¹ã—ãªã„ã€‚\n+- **å®Ÿè£…**: TypeDoc ã«ã‚ˆã‚‹ API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹è‡ªå‹•ç”Ÿæˆã¨ã€`scripts/doc-sync.js` ç­‰ã®å®Ÿè£…åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ CI ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆGitHub Actionsï¼‰ã«çµ„ã¿è¾¼ã¿ã€ã‚³ãƒ¼ãƒ‰ã¨ Markdown ä»•æ§˜æ›¸ã®ä¸€è²«æ€§ã‚’å¸¸æ™‚æ¤œè¨¼ã™ã‚‹ã€‚",
    "path": "docs/ZENITH_STANDARD.md",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "f7bd0d9ce82b9c9104ad5ec10db6af0008f88303",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸ”´ Critical_\n\n<details>\n<summary>ğŸ§© Analysis chain</summary>\n\nğŸ Script executed:\n\n```shell\n#!/bin/bash\n\necho \"=== Searching for doc-sync.js file ===\"\nfd \"doc-sync\" --type=f\n\necho \"\"\necho \"=== Checking for doc-sync references in .github/ ===\"\nrg \"doc-sync\" .github/ 2>/dev/null || echo \"No references found in .github/\"\n\necho \"\"\necho \"=== Checking scripts directory content ===\"\nif [ -d \"scripts\" ]; then\n  ls -la scripts/ 2>/dev/null | head -20\nelse\n  echo \"scripts directory not found\"\nfi\n\necho \"\"\necho \"=== Checking .github directory structure ===\"\nfind .github/ -type f -name \"*.yml\" -o -name \"*.yaml\" 2>/dev/null | head -20\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 592\n\n---\n\n\n\n</details>\n\n**`scripts/doc-sync.js` ã¯å­˜åœ¨ã›ãšã€GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«çµ±åˆã•ã‚Œã¦ã„ã¾ã›ã‚“**\n\næ¤œè¨¼ã®çµæœã€docs/ZENITH_STANDARD.md ã® Section 3.1 ã§è¨€åŠã•ã‚Œã¦ã„ã‚‹ `scripts/doc-sync.js` ã¯ãƒªãƒã‚¸ãƒˆãƒªã«å­˜åœ¨ã—ã¦ã„ã¾ã›ã‚“ã€‚ã¾ãŸã€.github/workflows/ å†…ã® CI ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆci.ymlã€release.ymlï¼‰ã«ã¯ doc-sync ã«é–¢ã™ã‚‹å‚ç…§ãŒã‚ã‚Šã¾ã›ã‚“ã€‚\n\nscripts/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ `pre-commit-check.sh` ã¨ `sync-mcp-tokens.js` ã®ã¿ãŒå­˜åœ¨ã—ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹è‡ªå‹•åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ CI çµ±åˆã¯å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¨˜è¿°ã¨å®Ÿè£…çŠ¶æ³ã®ä¹–é›¢ã‚’è§£æ±ºã—ã¦ãã ã•ã„ã€‚\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@docs/ZENITH_STANDARD.md` around lines 54 - 55, The doc claims a\nscripts/doc-sync.js and CI integration that don't exist; either implement the\nsync script and wire it into CI or remove/update the doc. Create a new\ndoc-sync.js that invokes TypeDoc (or generates the API reference) and compares\nthe generated output against the repository Markdown (e.g., TECHNICAL_SPECS.md),\nreturning a non-zero exit code on mismatch; add a package.json script entry\n(e.g., \"doc-sync\") and integrate that script into the existing CI workflows\n(ci.yml and release.yml) as a validation step so PRs fail on divergence; if you\nopt not to implement, instead update ZENITH_STANDARD.md to remove or clarify the\ndoc-sync reference and mention the current scripts (pre-commit-check.sh,\nsync-mcp-tokens.js) so the documentation matches the repo state.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:30:17Z",
    "updated_at": "2026-02-19T00:30:18Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083682",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083682"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083682"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 54,
    "original_start_line": 54,
    "start_side": "RIGHT",
    "line": 55,
    "original_line": 55,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 55,
    "position": 55,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083684",
    "pull_request_review_id": 3822891550,
    "id": 2825083684,
    "node_id": "PRRC_kwDORJ0gd86oY1sk",
    "diff_hunk": "@@ -43,8 +43,19 @@ export class EngineLoader implements IEngineLoader {\n \n     const promise = (async () => {\n       try {\n-        // 2026 Best Practice: HTTPS å¼·åˆ¶ (Security Alert å¯¾å¿œ)\n-        if (config.url.startsWith(\"http://\")) {\n+        // 2026 Best Practice: å®Ÿè¡Œãƒªã‚½ãƒ¼ã‚¹ï¼ˆWorker/WASMï¼‰ã®ã‚ªãƒªã‚¸ãƒ³æ¤œè¨¼\n+        if (config.type === \"worker-js\" || config.type === \"wasm\") {\n+          this.validateWorkerUrl(config.url, engineId);\n+        }\n+\n+        // 2026 Best Practice: HTTPS å¼·åˆ¶ (Strict Loopback Check)\n+        const url = new URL(config.url, window.location.href);\n+        const isLoopback =\n+          url.hostname === \"localhost\" ||\n+          url.hostname === \"127.0.0.1\" ||\n+          url.hostname === \"::1\";",
    "path": "packages/core/src/bridge/EngineLoader.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "f7bd0d9ce82b9c9104ad5ec10db6af0008f88303",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸ”´ Critical_\n\n<details>\n<summary>ğŸ§© Analysis chain</summary>\n\nğŸ Script executed:\n\n```shell\n# First, let's examine the actual EngineLoader.ts file to see the code context\ncat -n packages/core/src/bridge/EngineLoader.ts | head -80\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 3202\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check the validateWorkerUrl method around line 230\ncat -n packages/core/src/bridge/EngineLoader.ts | sed -n '220,260p'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 1360\n\n---\n\nğŸ Script executed:\n\n```shell\n# Search for all window references in the file\nrg -n 'window' packages/core/src/bridge/EngineLoader.ts\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 276\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check if there are SSR or Node.js environment tests\nfd -t f '\\.(test|spec)\\.' packages/core/src/bridge/ -x cat -n {} \\; | grep -A 5 -B 5 -i 'ssr\\|node\\|window'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 462\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check if window is guarded anywhere in the codebase\nrg -n 'typeof window' packages/core/src/bridge/\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 53\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check package.json or README for SSR mentions\nrg -i 'ssr|next.js' packages/core/\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 53\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check if EngineLoader is marked as browser-only or has any JSDoc indicating usage context\ncat -n packages/core/src/bridge/EngineLoader.ts | head -20\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 821\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check the types.ts to understand IEngineLoader interface\nrg -A 10 'interface IEngineLoader' packages/core/src/\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 632\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check where EngineLoader is imported/used in the codebase\nrg -n 'EngineLoader' packages/core/src/ --type=ts | grep -v '\\.test\\.'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 1601\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check the actual test file to see full context\nfd -name '*.test.ts' packages/core/src/bridge/ -exec cat -n {} \\;\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 301\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check package exports to see if EngineLoader is exposed publicly\nrg -n 'export.*EngineLoader' packages/core/\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 317\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check if EngineLoader is documented as browser-only or has any platform constraints\ncat -n packages/core/src/bridge/EngineLoader.ts | sed -n '10,20p'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 525\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check the test file to see how window is handled in Node.js context\nfind packages/core -name '*.test.ts' -path '*/bridge/*' -exec cat {} \\;\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 2745\n\n---\n\nğŸ Script executed:\n\n```shell\n# Verify if window is used elsewhere in the codebase and how it's guarded\nrg 'typeof window' packages/core/src/ --type=ts\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 193\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check if there are separate browser vs Node.js implementations\nfd -type f -name '*browser*' -o -name '*node*' packages/core/src/\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 241\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check if there's any SSR documentation or Next.js configuration\nfind packages/core -name 'README*' -o -name 'package.json' | xargs cat | grep -i -A 5 -B 5 'ssr\\|next\\|server'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 53\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check if EngineLoader is conditionally imported or feature-gated for browser-only\nrg -B 5 -A 5 'EngineLoader' packages/core/src/bridge/EngineBridge.ts | head -30\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 742\n\n---\n\nğŸ Script executed:\n\n```shell\n# Verify if there's a browser-specific export or polyfill setup\ncat packages/core/src/index.ts 2>/dev/null || echo \"File not found\"\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 768\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check if EngineLoader.ts or related files have any `@browser` or similar JSDoc tags\nrg '@browser|@client|browser-only' packages/core/src/bridge/\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 53\n\n---\n\nğŸ Script executed:\n\n```shell\n# Look for environment-based code splitting or dynamic imports that might indicate SSR awareness\nrg 'typeof window|typeof document|typeof global|isClient|isBrowser' packages/core/src/ --type=ts\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 300\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check the full context of SecurityAdvisor.ts to see the guard pattern\ncat -n packages/core/src/capabilities/SecurityAdvisor.ts | sed -n '1,50p'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 1597\n\n---\n\nğŸ Script executed:\n\n```shell\n# Verify if EngineBridge dynamically loads EngineLoader for browser only\ncat -n packages/core/src/bridge/EngineBridge.ts | sed -n '355,375p'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 899\n\n---\n\nğŸ Script executed:\n\n```shell\n# Check if there are any environment detection utilities in the codebase\nrg -n 'isBrowser|isNode|isServer' packages/core/src/ --type=ts\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 53\n\n---\n\nğŸ Script executed:\n\n```shell\n# Look at the actual line where EngineLoader is instantiated\ncat -n packages/core/src/bridge/EngineBridge.ts | sed -n '355,375p'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 899\n\n---\n\n\n\n</details>\n\n**`window.location` ã¯ SSR/Node.js ç’°å¢ƒã§ `ReferenceError` ã‚’å¼•ãèµ·ã“ã—ã¾ã™**\n\nLine 52ã€230ã€236 ã§ `window.location.href` ã¨ `window.location.origin` ã‚’å‚ç…§ã—ã¦ã„ã¾ã™ãŒã€SSR ç’°å¢ƒã§ã¯ `window` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆã¯ `vi.stubGlobal(\"window\", {...})` ã§ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚Œã¦ã„ã‚‹ãŸã‚é€šéã—ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã® SSR ç’°å¢ƒã§ã¯å®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚\n\n`SecurityAdvisor.ts` ã¨åŒæ§˜ã«ã€`typeof window !== \"undefined\"` ã‚¬ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚ã¾ãŸã¯SSRç’°å¢ƒã§ã®ä»£æ›¿å®Ÿè£…ã‚’ç”¨æ„ã—ã¦ãã ã•ã„ã€‚\n\n<details>\n<summary>ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n-        const url = new URL(config.url, window.location.href);\n+        const base = typeof window !== \"undefined\" ? window.location.href : \"https://localhost\";\n+        const url = new URL(config.url, base);\n```\n\n```diff\n-      const parsedUrl = new URL(url, window.location.href);\n-      // ...\n-      if (parsedUrl.origin !== window.location.origin && !isLoopback) {\n+      const base = typeof window !== \"undefined\" ? window.location.href : \"https://localhost\";\n+      const parsedUrl = new URL(url, base);\n+      const currentOrigin = typeof window !== \"undefined\" ? window.location.origin : \"https://localhost\";\n+      if (parsedUrl.origin !== currentOrigin && !isLoopback) {\n```\n</details>\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/core/src/bridge/EngineLoader.ts` around lines 52 - 56, EngineLoader\ncurrently accesses window.location (e.g. the new URL(config.url,\nwindow.location.href) expression and the origin checks that compute isLoopback\nand the other uses around lines 230/236), which will throw in SSR/Node; wrap\nthose accesses with a typeof window !== \"undefined\" guard and provide a safe\nfallback (for example use config.url as the base or an empty string/origin\nfallback) so the URL() construction and hostname/origin checks run only when\nwindow exists; update the URL creation, isLoopback computation, and any\nlocation-origin reads in EngineLoader.ts to use this guard and fallback behavior\nsimilarly to SecurityAdvisor.ts.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:phoenix -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:30:17Z",
    "updated_at": "2026-02-19T00:30:18Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083684",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083684"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083684"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083684/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 52,
    "original_start_line": 52,
    "start_side": "RIGHT",
    "line": 56,
    "original_line": 56,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 16,
    "position": 16,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083691",
    "pull_request_review_id": 3822891550,
    "id": 2825083691,
    "node_id": "PRRC_kwDORJ0gd86oY1sr",
    "diff_hunk": "@@ -0,0 +1,87 @@\n+import { FEN, EngineErrorCode } from \"../../types.js\";\n+export { FEN };\n+import { EngineError } from \"../../errors/EngineError.js\";\n+\n+/** ãƒã‚§ã‚¹å±€é¢æƒ…å ±ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒª */\n+export function createFEN(pos: string): FEN {\n+  if (typeof pos !== \"string\" || pos.trim().length === 0) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: \"Invalid FEN: Input must be a non-empty string.\", // Key: engine.errors.invalidFEN\n+    });\n+  }\n+\n+  const trimmedPos = pos.trim();\n+\n+  // 2026 Best Practice: Character Whitelist Validation (Refuse by Exception)\n+  // FEN characters: digits 0-9, rnbqkpRNBQKP, 'w', slashes '/', spaces ' ', and '-'\n+  if (!/^[0-9rnbqkpRNBQKPw/\\s-]+$/.test(trimmedPos)) {\n+    throw new EngineError({\n+      code: EngineErrorCode.SECURITY_ERROR,\n+      message: \"Invalid FEN: Illegal characters detected.\", // Key: engine.errors.illegalCharacters\n+      remediation:\n+        \"FEN should only contain [0-9], [a-z], [A-Z], '/', ' ', and '-'.\",\n+    });\n+  }",
    "path": "packages/core/src/domains/chess/index.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "f7bd0d9ce82b9c9104ad5ec10db6af0008f88303",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸ”´ Critical_\n\n**é‡å¤§ãƒã‚°: æ–‡å­—ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã« `a`, `c`, `d`, `e`, `f`, `g`, `h` ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚**\n\næ­£è¦è¡¨ç¾ `/^[0-9rnbqkpRNBQKPw/\\s-]+$/` ã¯ FEN ã§å¿…è¦ãªæ–‡å­—ã®ä¸€éƒ¨ãŒæ¬ è½ã—ã¦ã„ã¾ã™ã€‚\n\nå…·ä½“çš„ã«ä¸è¶³ã—ã¦ã„ã‚‹æ–‡å­—:\n- **ã‚¢ãƒ³ãƒ‘ãƒƒã‚µãƒ³ç›®æ¨™ãƒã‚¹**: `a3`, `c6`, `e3`, `f6` ç­‰ã®è¡¨è¨˜ã« `a`, `c`, `d`, `e`, `f`, `g`, `h` ãŒå¿…è¦\n- **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚«ãƒ©ãƒ¼**: `b`ï¼ˆé»’æ‰‹ç•ªï¼‰ã¯é§’æ–‡å­— `b` ã§ã‚«ãƒãƒ¼ã•ã‚Œã¾ã™ãŒã€å¶ç„¶ã®ä¸€è‡´ã«ä¾å­˜\n\nçµæœã¨ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãª**å®Œå…¨ã«æœ‰åŠ¹ãª FEN** ãŒ `SECURITY_ERROR` ã§æ‹’å¦ã•ã‚Œã¾ã™:\n```\nrnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1\n```\nï¼ˆ`e3` ã® `e` ãŒãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«å«ã¾ã‚Œãªã„ãŸã‚ï¼‰\n\nã¾ãŸã€remediation ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆ23è¡Œç›®ï¼‰ã§ã¯ `[a-z], [A-Z]` ã¨è¨˜è¼‰ã•ã‚Œã¦ãŠã‚Šã€å®Ÿéš›ã®æ­£è¦è¡¨ç¾ã‚ˆã‚Šã‚‚åºƒã„ç¯„å›²ã‚’ç¤ºå”†ã—ã¦ã„ã‚‹ãŸã‚çŸ›ç›¾ã—ã¦ã„ã¾ã™ã€‚\n\n\n\n<details>\n<summary>ğŸ› ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n-  if (!/^[0-9rnbqkpRNBQKPw/\\s-]+$/.test(trimmedPos)) {\n+  if (!/^[0-9a-hA-Hw/\\s-]+$/.test(trimmedPos)) {\n```\n\nã‚ã‚‹ã„ã¯ã€remediation ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«åˆã‚ã›ã¦ã‚ˆã‚Šå¯›å®¹ã«:\n\n```diff\n-  if (!/^[0-9rnbqkpRNBQKPw/\\s-]+$/.test(trimmedPos)) {\n+  if (!/^[0-9a-zA-Z/\\s-]+$/.test(trimmedPos)) {\n```\n</details>\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/core/src/domains/chess/index.ts` around lines 18 - 25, The whitelist\nregex used to validate trimmedPos is missing lowercase file letters (a-h) and\nother valid FEN characters, causing valid FENs (e.g., en passant squares like\n\"e3\") to be rejected; update the regex in the validation (the\n/^[0-9rnbqkpRNBQKPw/\\s-]+$/ check for trimmedPos) to include all required\ncharacters (lowercase a-h and any other FEN tokens you intend to allow) and make\nthe EngineError message/remediation (EngineError with code\nEngineErrorCode.SECURITY_ERROR) consistent with the new regex â€” ensure the\nremediation text matches the actual allowed set.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:phoenix -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:30:17Z",
    "updated_at": "2026-02-19T00:30:18Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083691",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083691"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083691"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 35,
    "original_start_line": 18,
    "start_side": "RIGHT",
    "line": 42,
    "original_line": 25,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 25,
    "position": 42,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083695",
    "pull_request_review_id": 3822891550,
    "id": 2825083695,
    "node_id": "PRRC_kwDORJ0gd86oY1sv",
    "diff_hunk": "@@ -1,72 +1,17 @@\n-import { describe, it, expect, beforeAll, afterAll, vi } from \"vitest\";\n-import { render } from \"@testing-library/react\";\n import React from \"react\";\n-import { ChessBoard } from \"../BoardComponents.js\";\n-import { createFEN, createMove, FEN, Move } from \"@multi-game-engines/core\";\n-\n-interface ChessBoardElement extends HTMLElement {\n-  fen: FEN;\n-  lastMove: Move;\n-  orientation: string;\n-  boardLabel: string;\n-  errorMessage: string;\n-  pieceNames: Record<string, string>;\n-}\n-\n-describe(\"ChessBoard (React)\", () => {\n-  beforeAll(() => {\n-    vi.spyOn(performance, \"now\").mockReturnValue(0);\n-  });\n-\n-  afterAll(() => {\n-    vi.restoreAllMocks();\n-  });\n-\n-  it(\"should render chess-board custom element with props mapped correctly\", async () => {\n+import { describe, it, expect, vi } from \"vitest\";\n+import { render, screen, waitFor } from \"@testing-library/react\";\n+import { ChessBoard } from \"../chess/index.js\";\n+import { createFEN, FEN } from \"@multi-game-engines/core/chess\";\n+import { Move } from \"@multi-game-engines/core\";\n+\n+describe(\"ChessBoard\", () => {\n+  it(\"should render without crashing\", () => {\n     const fen = createFEN(\n       \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\",\n     );\n-    const lastMove = createMove(\"e2e4\");\n-    const pieceNames = { P: \"Pawn\", p: \"Gote Pawn\" };\n-    const { container } = render(\n-      <ChessBoard\n-        fen={fen}\n-        lastMove={lastMove}\n-        orientation=\"black\"\n-        className=\"custom-class\"\n-        boardLabel=\"Custom Chess Board\"\n-        errorMessage=\"Custom Error\"\n-        pieceNames={pieceNames}\n-      />,\n-    );\n-\n-    const board = container.querySelector<ChessBoardElement>(\"chess-board\");\n-    expect(board).toBeTruthy();\n-\n-    if (board) {\n-      // In React 19, properties are preferred for custom elements if they exist.\n-      expect(board.fen).toBe(fen);\n-      expect(board.lastMove).toBe(lastMove);\n-      expect(board.orientation).toBe(\"black\");\n-      expect(board.boardLabel).toBe(\"Custom Chess Board\");\n-      expect(board.errorMessage).toBe(\"Custom Error\");\n-      expect(board.pieceNames).toEqual(pieceNames);\n-\n-      expect(board.getAttribute(\"class\")).toBe(\"custom-class\");\n-    }\n-  });\n-\n-  it(\"should not set optional attributes when undefined\", () => {\n-    const fen = createFEN(\"8/8/8/8/8/8/8/8 w - - 0 1\");\n-    const { container } = render(<ChessBoard fen={fen} />);\n-\n-    const board = container.querySelector<ChessBoardElement>(\"chess-board\");\n-    expect(board).toBeTruthy();\n-    if (board) {\n-      expect(board.getAttribute(\"last-move\")).toBeNull();\n-      expect(board.getAttribute(\"orientation\")).toBeNull();\n-      expect(board.getAttribute(\"board-label\")).toBeNull();\n-      expect(board.getAttribute(\"error-message\")).toBeNull();\n-    }\n+    render(<ChessBoard fen={fen} />);\n+    const el = document.querySelector(\"mg-chess-board\");\n+    expect(el).toBeDefined();",
    "path": "packages/ui-react/src/__tests__/ChessBoard.test.tsx",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "f7bd0d9ce82b9c9104ad5ec10db6af0008f88303",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸ”´ Critical_\n\n<details>\n<summary>ğŸ§© Analysis chain</summary>\n\nğŸ Script executed:\n\n```shell\n#!/bin/bash\n# Find the ChessBoard test file and read it\nfind . -name \"ChessBoard.test.tsx\" -type f\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 124\n\n---\n\nğŸ Script executed:\n\n```shell\n#!/bin/bash\n# Find the ChessBoard component index.tsx\nfind . -path \"*/ui-react/src/*\" -name \"index.tsx\" -type f\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 150\n\n---\n\nğŸ Script executed:\n\n```shell\n#!/bin/bash\n# Search for custom element definition patterns\nrg -n \"customElements.define\" --type=ts -A 2 -B 2\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 53\n\n---\n\nğŸ Script executed:\n\n```shell\n#!/bin/bash\n# Search for chess-board or mg-chess-board tag usage\nrg -n \"chess-board|mg-chess-board\" --type=ts --type=tsx\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 98\n\n---\n\nğŸ Script executed:\n\n```shell\n#!/bin/bash\n# Read the test file to see full context\ncat -n \"./packages/ui-react/src/__tests__/ChessBoard.test.tsx\"\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 809\n\n---\n\nğŸ Script executed:\n\n```shell\n#!/bin/bash\n# Read the chess component index file to see what element is rendered\ncat -n \"./packages/ui-react/src/chess/index.tsx\"\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 3428\n\n---\n\nğŸ Script executed:\n\n```shell\n#!/bin/bash\n# Search for custom element definitions (trying different approach)\nrg \"customElements\\.define|<chess-board|<mg-chess-board\" -A 2\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 5742\n\n---\n\n\n\n</details>\n\n**ãƒ†ã‚¹ãƒˆãŒå¸¸ã«ãƒ‘ã‚¹ã™ã‚‹ç©ºæŒ¯ã‚Šã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ â€• è‡´å‘½çš„ãªæ­£ç¢ºæ€§ãƒã‚°**\n\n2ã¤ã®å•é¡ŒãŒé‡ãªã£ã¦ã“ã®ãƒ†ã‚¹ãƒˆã‚’å®Œå…¨ãªç„¡åŠ¹ã‚³ãƒ¼ãƒ‰ã«ã—ã¦ã„ã¾ã™ã€‚\n\n1. **ã‚»ãƒ¬ã‚¯ã‚¿åã®ä¸ä¸€è‡´**: `document.querySelector(\"mg-chess-board\")` ã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒã€`ChessBoard` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ`packages/ui-react/src/chess/index.tsx` Line 82ï¼‰ã¯ `<chess-board>` ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚`mg-chess-board` è¦ç´ ã¯ DOM ä¸Šã«å­˜åœ¨ã—ãªã„ãŸã‚ã€`el` ã¯å¸¸ã« `null` ã«ãªã‚Šã¾ã™ã€‚\n\n2. **ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³æ‰‹æ³•ã®èª¤ã‚Š**: `toBeDefined()` ã¯å€¤ãŒ `undefined` ã§ãªã„ã“ã¨ã‚’æ¤œæŸ»ã—ã¾ã™ã€‚ `null` ã¯ `undefined` ã§ã¯ãªã„ãŸã‚ `expect(null).toBeDefined()` ã¯**å¸¸ã«æˆåŠŸ**ã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½•ã‚‚ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ãªãã¦ã‚‚ã€ã“ã®ãƒ†ã‚¹ãƒˆã¯é€šéã—ã¦ã—ã¾ã„ã¾ã™ã€‚\n\n<details>\n<summary>ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n-    const el = document.querySelector(\"mg-chess-board\");\n-    expect(el).toBeDefined();\n+    expect(document.querySelector(\"chess-board\")).not.toBeNull();\n```\n\n</details>\n\n<!-- suggestion_start -->\n\n<details>\n<summary>ğŸ“ Committable suggestion</summary>\n\n> â€¼ï¸ **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n    expect(document.querySelector(\"chess-board\")).not.toBeNull();\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/ui-react/src/__tests__/ChessBoard.test.tsx` around lines 14 - 15,\nThe test in ChessBoard.test.tsx is using the wrong selector and a weak\nassertion: change the selector from \"mg-chess-board\" to \"chess-board\" to match\nthe ChessBoard component's rendered tag, and replace expect(el).toBeDefined()\nwith a proper presence check such as expect(el).not.toBeNull() (or use\ntesting-library's expect(el).toBeInTheDocument() if you render via\n`@testing-library/react`). Ensure you locate the query in the test file and update\nthe assertion accordingly so the test actually fails when the component is not\nrendered.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:30:17Z",
    "updated_at": "2026-02-19T00:30:19Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083695",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083695"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083695"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 14,
    "original_start_line": 14,
    "start_side": "RIGHT",
    "line": 15,
    "original_line": 15,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 81,
    "position": 81,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083699",
    "pull_request_review_id": 3822891550,
    "id": 2825083699,
    "node_id": "PRRC_kwDORJ0gd86oY1sz",
    "diff_hunk": "@@ -1,75 +1,16 @@\n-import { describe, it, expect, beforeAll, afterAll, vi } from \"vitest\";\n-import { render } from \"@testing-library/react\";\n import React from \"react\";\n-import { ShogiBoard } from \"../BoardComponents.js\";\n-import { createSFEN, createMove, SFEN, Move } from \"@multi-game-engines/core\";\n+import { describe, it, expect } from \"vitest\";\n+import { render, waitFor } from \"@testing-library/react\";\n+import { ShogiBoard } from \"../shogi/index.js\";\n+import { createSFEN, SFEN } from \"@multi-game-engines/core/shogi\";\n \n-interface ShogiBoardElement extends HTMLElement {\n-  sfen: SFEN;\n-  lastMove: Move;\n-  boardLabel: string;\n-  errorMessage: string;\n-  handSenteLabel: string;\n-  handGoteLabel: string;\n-  pieceNames: Record<string, string>;\n-}\n-\n-describe(\"ShogiBoard (React)\", () => {\n-  beforeAll(() => {\n-    vi.spyOn(performance, \"now\").mockReturnValue(0);\n-  });\n-\n-  afterAll(() => {\n-    vi.restoreAllMocks();\n-  });\n-\n-  it(\"should render shogi-board custom element with props mapped correctly\", async () => {\n+describe(\"ShogiBoard\", () => {\n+  it(\"should render without crashing\", () => {\n     const sfen = createSFEN(\n       \"lnsgkgsnl/1r5b1/ppppppppp/9/9/9/PPPPPPPPP/1B5R1/LNSGKGSNL b - 1\",\n     );\n-    const lastMove = createMove(\"7g7f\");\n-    const pieceNames = { P: \"æ­©\", K: \"ç‹\" };\n-    const { container } = render(\n-      <ShogiBoard\n-        sfen={sfen}\n-        lastMove={lastMove}\n-        className=\"shogi-custom\"\n-        boardLabel=\"Custom Shogi Board\"\n-        errorMessage=\"Custom Error\"\n-        handSenteLabel=\"Sente pieces\"\n-        handGoteLabel=\"Gote pieces\"\n-        pieceNames={pieceNames}\n-      />,\n-    );\n-\n-    const board = container.querySelector<ShogiBoardElement>(\"shogi-board\");\n-    expect(board).toBeTruthy();\n-\n-    if (board) {\n-      expect(board.sfen).toBe(sfen);\n-      expect(board.lastMove).toBe(lastMove);\n-      expect(board.boardLabel).toBe(\"Custom Shogi Board\");\n-      expect(board.errorMessage).toBe(\"Custom Error\");\n-      expect(board.handSenteLabel).toBe(\"Sente pieces\");\n-      expect(board.handGoteLabel).toBe(\"Gote pieces\");\n-      expect(board.pieceNames).toEqual(pieceNames);\n-\n-      expect(board.getAttribute(\"class\")).toBe(\"shogi-custom\");\n-    }\n-  });\n-\n-  it(\"should not set optional attributes when undefined\", () => {\n-    const sfen = createSFEN(\"9/9/9/9/9/9/9/9/9 b - 1\");\n-    const { container } = render(<ShogiBoard sfen={sfen} />);\n-\n-    const board = container.querySelector<ShogiBoardElement>(\"shogi-board\");\n-    expect(board).toBeTruthy();\n-    if (board) {\n-      expect(board.getAttribute(\"last-move\")).toBeNull();\n-      expect(board.getAttribute(\"board-label\")).toBeNull();\n-      expect(board.getAttribute(\"error-message\")).toBeNull();\n-      expect(board.getAttribute(\"hand-sente-label\")).toBeNull();\n-      expect(board.getAttribute(\"hand-gote-label\")).toBeNull();\n-    }\n+    render(<ShogiBoard sfen={sfen} />);\n+    const el = document.querySelector(\"mg-shogi-board\");\n+    expect(el).toBeDefined();",
    "path": "packages/ui-react/src/__tests__/ShogiBoard.test.tsx",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "f7bd0d9ce82b9c9104ad5ec10db6af0008f88303",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸ”´ Critical_\n\n**ãƒ†ã‚¹ãƒˆãŒå¸¸ã«ãƒ‘ã‚¹ã™ã‚‹å½é™½æ€§ãƒã‚°: ã‚»ãƒ¬ã‚¯ã‚¿ä¸ä¸€è‡´ + ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³èª¤ã‚Š**\n\n2ã¤ã®å•é¡ŒãŒçµ„ã¿åˆã‚ã•ã‚Šã€ã“ã®ãƒ†ã‚¹ãƒˆã¯è¦ç´ ã®å­˜åœ¨ã‚’å®Ÿéš›ã«ã¯æ¤œè¨¼ã§ãã¦ã„ã¾ã›ã‚“ï¼š\n\n1. **ã‚»ãƒ¬ã‚¯ã‚¿ã®ä¸ä¸€è‡´** (Line 13): ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ `<shogi-board>` ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ãŒï¼ˆ`index.tsx` Line 87ã€IntrinsicElements ã®å®£è¨€ã‚‚ `\"shogi-board\"`ï¼‰ã€ãƒ†ã‚¹ãƒˆã§ã¯ `\"mg-shogi-board\"` ã‚’ã‚¯ã‚¨ãƒªã—ã¦ã„ã¾ã™ã€‚è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãš `null` ãŒè¿”ã•ã‚Œã¾ã™ã€‚\n\n2. **ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã®èª¤ã‚Š** (Line 14): `expect(el).toBeDefined()` ã¯ `null` ã«å¯¾ã—ã¦ã‚‚é€šéã—ã¾ã™ã€‚`querySelector` ã¯è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ `null` ã‚’è¿”ã—ã¾ã™ãŒã€`null !== undefined` ãªã®ã§ `toBeDefined()` ã¯å¸¸ã«æˆåŠŸã—ã¾ã™ã€‚\n\nçµæœã¨ã—ã¦ã€ã“ã®ãƒ†ã‚¹ãƒˆã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã‹ã©ã†ã‹ã«é–¢ä¿‚ãªãå¸¸ã«ãƒ‘ã‚¹ã—ã¾ã™ã€‚\n\n<details>\n<summary>ğŸ› ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n-    const el = document.querySelector(\"mg-shogi-board\");\n-    expect(el).toBeDefined();\n+    const el = document.querySelector(\"shogi-board\");\n+    expect(el).not.toBeNull();\n```\n\nã¾ãŸã¯ `@testing-library/jest-dom` ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼š\n\n```diff\n-    const el = document.querySelector(\"mg-shogi-board\");\n-    expect(el).toBeDefined();\n+    const el = document.querySelector(\"shogi-board\");\n+    expect(el).toBeInTheDocument();\n```\n</details>\n\næ³¨æ„: æ­£ã—ã„ã‚¿ã‚°åã¯ã‚«ã‚¹ã‚¿ãƒ è¦ç´ ã®ç™»éŒ²åã«ä¾å­˜ã—ã¾ã™ã€‚ä¸Šè¨˜ã‚³ãƒ¡ãƒ³ãƒˆã®æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ `customElements.define` ã®ç™»éŒ²ã‚¿ã‚°åã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/ui-react/src/__tests__/ShogiBoard.test.tsx` around lines 12 - 14,\nThe test is a false-positive because it queries the wrong tag name and uses an\ninappropriate assertion: update the selector in the ShogiBoard test (where\nrender(<ShogiBoard sfen={sfen} />) is called) to match the real custom element\ntag registered (replace \"mg-shogi-board\" with the actual tag, e.g.,\n\"shogi-board\" as registered via customElements.define) and change the assertion\nfrom expect(el).toBeDefined() to a strict presence check such as\nexpect(el).not.toBeNull() or, if using `@testing-library/jest-dom`,\nexpect(el).toBeInTheDocument(); also verify the registered tag name in the\ncomponent/registration code (customElements.define) if unsure.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:medusa:phoenix -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:30:17Z",
    "updated_at": "2026-02-19T00:30:19Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083699",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083699"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825083699"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825083699/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 12,
    "original_start_line": 12,
    "start_side": "RIGHT",
    "line": 14,
    "original_line": 14,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 82,
    "position": 82,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140274",
    "pull_request_review_id": 3822948957,
    "id": 2825140274,
    "node_id": "PRRC_kwDORJ0gd86oZDgy",
    "diff_hunk": "@@ -62,15 +62,73 @@\n \n ---\n \n-## 4. å…±é€šã®æ´—ç·´ï¼ˆ2026 Best Practiceï¼‰\n+## 4. ãƒãƒƒã‚¯ã‚®ãƒ£ãƒ¢ãƒ³: GNU Backgammon (adapter-gnubg)\n \n-### 4.1 Zero-Any Policy\n+### 4.1 ãƒ—ãƒ­ãƒˆã‚³ãƒ«: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (CLI)\n+\n+- **ç‰¹å¾´**: æ­´å²çš„ãª C è¨€èªãƒ™ãƒ¼ã‚¹ã®å®Ÿè£…ã§ã‚ã‚Šã€ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚‹å¯¾è©±ã€‚\n+- **å®Ÿè£…èª²é¡Œ**: WASM ç’°å¢ƒã«ãŠã‘ã‚‹å¯¾è©±å‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€‚\n+- **å‹å®šç¾©**:\n+  - `T_INFO`: è©•ä¾¡å€¤ï¼ˆEquitiesï¼‰ã€å‹ç‡åˆ†å¸ƒã€ãƒ ãƒ¼ãƒ–ã®æœŸå¾…å€¤æå¤±ã€‚\n+\n+---\n+\n+## 5. ãƒã‚§ãƒƒã‚«ãƒ¼: KingsRow / Scan (adapter-checkers)\n+\n+### 5.1 ãƒ—ãƒ­ãƒˆã‚³ãƒ«: ç‹¬è‡ªãƒ†ã‚­ã‚¹ãƒˆãƒ—ãƒ­ãƒˆã‚³ãƒ«\n+\n+- **ç‰¹å¾´**: ã‚·ãƒ³ãƒ—ãƒ«ãªæŒ‡ã—æ‰‹ã¨è©•ä¾¡å€¤ã®ã‚„ã‚Šå–ã‚Šã€‚\n+- **æ¼”ç®—åŠ é€Ÿ**: å·¨å¤§ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆã‚¨ãƒ³ãƒ‰ã‚²ãƒ¼ãƒ ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰ã®åŠ¹ç‡çš„ãªãƒ­ãƒ¼ãƒ‰ã€‚\n+\n+---\n+\n+## 6. ä¸­å›½å°†æ£‹ (Xiangqi): ElephantEye / Stockfish (adapter-xiangqi)\n+\n+### 6.1 ãƒ—ãƒ­ãƒˆã‚³ãƒ«: UCCI (Universal Chinese Chess Interface)\n+\n+- **ç‰¹å¾´**: UCI ã«æ¥µã‚ã¦è¿‘ã„ãŒã€FEN ã§ã¯ãªã WEN (Xiangqi Fen) ã‚’ä½¿ç”¨ã€‚",
    "path": "docs/implementation_plans/extended-adapters-design.md",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "86a425c6cc0753096ae977794ede356639aab065",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸŸ¡ Minor_\n\n<details>\n<summary>ğŸ§© Analysis chain</summary>\n\nğŸŒ Web query:\n\n`UCCI protocol official specification Xiangqi position notation FEN`\n\nğŸ’¡ Result:\n\n### Official UCCI specification (protocol + how positions are sent)\nThe closest thing to an â€œofficialâ€ UCCI spec that is widely treated as canonical is the **XQBase â€œä¸­å›½è±¡æ£‹ç”µè„‘åº”ç”¨è§„èŒƒ(äº”)ï¼šä¸­å›½è±¡æ£‹é€šç”¨å¼•æ“åè®®â€** page. It defines (among other commands) how a GUI sends a position to an engine:\n\n- `position { fen <fen_str> | startpos } [moves <move_list>]`  \n- `startpos` is defined as equivalent to the Xiangqi start FEN:  \n  `rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR w - - 0 1`  \n- UCCI also specifies that because plain FEN cannot encode repetition/â€œlong checkâ€ history, GUIs should append a `moves ...` list (and often use a â€œbaseâ€ FEN from the last capture / start position, then list subsequent moves) to preserve the needed history. [1]\n\n### Xiangqi FEN position notation (as used with UCCI `position fen ...`)\nXQBaseâ€™s **â€œä¸­å›½è±¡æ£‹ç”µè„‘åº”ç”¨è§„èŒƒ(ä¸‰)ï¼šFENæ–‡ä»¶æ ¼å¼â€** defines the Xiangqi FEN string used by UCCI and gives examples in the exact `... w - - 0 1` style above. It also explicitly notes the limitation of FEN for history and the need for `moves` in UCCI. [2]\n\nIn practice, Xiangqi FEN in UCCI follows standard FENâ€™s 6-field structure (piece placement / side to move / â€¦ / move counters), but Xiangqi typically uses `- -` for the chess-specific castling and en-passant fields. [5][2]\n\n**Piece letters commonly used in Xiangqi FEN (UCCI ecosystem):**\n- `k` general (king), `a` advisor, `b` elephant (bishop), `n` horse (knight), `r` chariot (rook), `c` cannon, `p` pawn; uppercase for Red. [3][4]\n\n**Board encoding:**\n- 10 ranks separated by `/`, digits `1`â€“`9` compress consecutive empty points (since a Xiangqi rank has 9 files). [3]\n\n**Example (start position, Red to move):**  \n`rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR w - - 0 1` [1][2]\n\n**Sources:**  \n[1] XQBase â€“ ä¸­å›½è±¡æ£‹ç”µè„‘åº”ç”¨è§„èŒƒ(äº”)ï¼šä¸­å›½è±¡æ£‹é€šç”¨å¼•æ“åè®® (UCCI)  \n[2] XQBase â€“ ä¸­å›½è±¡æ£‹ç”µè„‘åº”ç”¨è§„èŒƒ(ä¸‰)ï¼šFENæ–‡ä»¶æ ¼å¼  \n[3] Super Web Chinese Chess â€“ FEN format (piece letters + rank structure notes)  \n[4] Crowded Xiangqi â€“ notes the `krncabp` mapping used in Xiangqi FEN contexts  \n[5] Wikipedia â€“ Forsythâ€“Edwards Notation (standard 6-field definition)\n\n---\n\nğŸŒ Web query:\n\n`WEN Xiangqi FEN standard notation chess variant`\n\nğŸ’¡ Result:\n\nThere isnâ€™t a widely used **â€œWENâ€**-specific FEN standard for Xiangqi; the deâ€‘facto standard is simply **FEN adapted to Xiangqi**, using **WXF piece letters**. ([chessprogramming.org](https://www.chessprogramming.org/Chinese_Chess))\n\n## Xiangqi FEN (deâ€‘facto)\n**Format (same 6 fields as chess FEN):**  \n`<board> <side-to-move> - - <halfmove> <fullmove>`  \n(Xiangqi doesnâ€™t use castling or enâ€‘passant, so those fields are typically `- -`.) ([chessprogramming.org](https://www.chessprogramming.org/Chinese_Chess))\n\n### Piece letters (WXF)\n- **K** King/General, **A** Advisor, **E** Elephant, **R** Rook/Chariot, **C** Cannon, **H** Horse, **P** Pawn  \nUppercase = Red, lowercase = Black. ([yumpu.com](https://www.yumpu.com/en/document/view/19170346/fen-for-xiangqi-chinese-chess-))\n\n### Starting position (commonly used)\n```\nrheakaehr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RHEAKAEHR w - - 0 1\n```\n([chessprogramming.org](https://www.chessprogramming.org/Chinese_Chess))\n\nCitations:\n\n- 1: https://www.chessprogramming.org/Chinese_Chess\n- 2: https://www.chessprogramming.org/Chinese_Chess\n- 3: https://www.yumpu.com/en/document/view/19170346/fen-for-xiangqi-chinese-chess-\n- 4: https://www.chessprogramming.org/Chinese_Chess\n\n---\n\nğŸŒ Web query:\n\n`UCCI \"position fen\" command Xiangqi specification`\n\nğŸ’¡ Result:\n\nIn **UCCI (Universal Chinese Chess Interface)**, the command to set a Xiangqi position using FEN is:\n\n- `position fen <fen_string> [moves <move1> <move2> ...]`\n- or `position startpos [moves ...]` where `startpos` is equivalent to the standard initial Xiangqi FEN. ([xqbase.com](https://www.xqbase.com/protocol/cchess_ucci.htm?utm_source=openai))\n\n### What `position fen` means (UCCI-specific details)\n\n1. **`<fen_string>` is a Xiangqi FEN** (10 ranks, separated by `/`), followed by fields like side-to-move (`w`/`b`) and then typically `- - 0 1` (castling/en-passant are unused in Xiangqi but kept for compatibility). Example from the UCCI spec:  \n   `position fen rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR w - - 0 1` ([xqbase.com](https://www.xqbase.com/protocol/cchess_ucci.htm?utm_source=openai))\n\n2. **`moves ...` is how UCCI conveys history** (important for repetition / perpetual-check rules). Because FEN alone is a snapshot, UCCI commonly sends a â€œbaseâ€ FEN (often the position after the last capture, or the start position) and then appends all subsequent moves via `moves`. ([xqbase.com](https://www.xqbase.com/protocol/cchess_ucci.htm?utm_source=openai))\n\n3. **Move coordinate notation (UCCI):** moves are in coordinate form like `b0c2`, using files `a`â€“`i` and ranks `0`â€“`9` (i.e., ranks are 0-based). ([xqbase.com](https://www.xqbase.com/protocol/cchess_ucci.htm?utm_source=openai))\n\nCitations:\n\n- 1: https://www.xqbase.com/protocol/cchess_ucci.htm?utm_source=openai\n- 2: https://www.xqbase.com/protocol/cchess_ucci.htm?utm_source=openai\n- 3: https://www.xqbase.com/protocol/cchess_ucci.htm?utm_source=openai\n- 4: https://www.xqbase.com/protocol/cchess_ucci.htm?utm_source=openai\n\n---\n\n\n\n</details>\n\n**UCCI ä»•æ§˜ã§ã¯ã€ŒFENã€ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã€ŒWENã€ã¯å…¬å¼ãªç”¨èªã§ã¯ã‚ã‚Šã¾ã›ã‚“**\n\nUCCI ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®å…¬å¼ä»•æ§˜ï¼ˆXQBaseãƒ»ä¸­å›½è±¡æ£‹é€šç”¨å¼•æ“å”è­°ï¼‰ã§ã¯ã€å±€é¢æŒ‡å®šã« `position fen <fen_string>` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã€Xiangqi ç”¨ã® FEN è¡¨è¨˜ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ã€ŒWENã€ã¨ã„ã†ç”¨èªã¯ UCCI æ¨™æº–ä»•æ§˜ã«å­˜åœ¨ã—ãªã„ãŸã‚ã€å®Ÿè£…è€…ãŒæ··ä¹±ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n\nãƒã‚§ã‚¹ã® FEN ã¨åŒã˜ 6 ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ§‹é€ ã‚’æŒã¡ã€é§’è¡¨è¨˜ã®ã¿ãŒç•°ãªã‚Šã¾ã™ï¼ˆä¾‹ï¼š`rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR w - - 0 1`ï¼‰ã€‚\n\n<details>\n<summary>ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n-- **ç‰¹å¾´**: UCI ã«æ¥µã‚ã¦è¿‘ã„ãŒã€FEN ã§ã¯ãªã WEN (Xiangqi Fen) ã‚’ä½¿ç”¨ã€‚\n+- **ç‰¹å¾´**: UCI ã«æ¥µã‚ã¦è¿‘ã„ãŒã€ãƒã‚§ã‚¹ FEN ã¨æ§‹é€ ã¯åŒä¸€ã§é§’è¡¨è¨˜ã®ã¿ç•°ãªã‚‹ Xiangqi FEN ã‚’ä½¿ç”¨ã€‚\n```\n</details>\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@docs/implementation_plans/extended-adapters-design.md` at line 89, Update the\nwording that currently says \"WEN (Xiangqi Fen)\" to use the official UCCI/XQBase\nterm \"FEN\" and reference the UCCI position command semantics (i.e., use\n\"position fen <fen_string>\"); remove any mention of \"WEN\" as a separate standard\nterm, note that Xiangqi uses a FEN-like string with Xiangqi piece notation\n(e.g., the example fen `rnbakabnr/9/1c5c1/...`), and ensure the sentence in the\nfile that begins \"**ç‰¹å¾´**: UCI ã«æ¥µã‚ã¦è¿‘ã„ãŒã€FEN ã§ã¯ãªã WEN (Xiangqi Fen) ã‚’ä½¿ç”¨ã€‚\" is\nchanged to reflect that UCCI uses FEN (not \"WEN\") and how to supply it via\n`position fen <fen_string>`.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:56:53Z",
    "updated_at": "2026-02-19T00:56:56Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140274",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140274"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140274"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140274/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 89,
    "original_line": 89,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 30,
    "position": 30,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140278",
    "pull_request_review_id": 3822948957,
    "id": 2825140278,
    "node_id": "PRRC_kwDORJ0gd86oZDg2",
    "diff_hunk": "@@ -0,0 +1,69 @@\n+import {\n+  describe,\n+  it,\n+  expect,\n+  vi,\n+  beforeEach,\n+  beforeAll,\n+  afterAll,\n+} from \"vitest\";\n+import { GTPAdapter } from \"../GTPAdapter.js\";\n+import { IEngineConfig } from \"@multi-game-engines/core\";\n+\n+class MockWorker {\n+  postMessage = vi.fn((msg: unknown) => {\n+    if (\n+      msg &&\n+      typeof msg === \"object\" &&\n+      (msg as Record<string, unknown>).type === \"MG_INJECT_RESOURCES\"\n+    ) {\n+      setTimeout(() => {\n+        if (typeof this.onmessage === \"function\") {\n+          this.onmessage({ data: { type: \"MG_RESOURCES_READY\" } });\n+        }\n+      }, 0);\n+    }\n+  });\n+  terminate = vi.fn();\n+  onmessage: ((ev: { data: unknown }) => void) | null = null;\n+  onerror: unknown = null;\n+}\n+\n+describe(\"GTPAdapter\", () => {\n+  const config: IEngineConfig = {\n+    id: \"test-gtp\",\n+    adapter: \"gtp\",\n+    name: \"Test GTP Engine\",\n+    sources: {\n+      main: {\n+        url: \"https://example.com/engine.js\",\n+        __unsafeNoSRI: true,\n+        type: \"worker-js\",\n+      },\n+    },\n+  };\n+\n+  beforeAll(() => {\n+    vi.spyOn(performance, \"now\").mockReturnValue(0);\n+  });\n+\n+  afterAll(() => {\n+    vi.restoreAllMocks();\n+  });\n+\n+  beforeEach(() => {\n+    vi.stubGlobal(\"Worker\", MockWorker);\n+  });",
    "path": "packages/adapter-gtp/src/__tests__/GTPAdapter.test.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "86a425c6cc0753096ae977794ede356639aab065",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸŸ¡ Minor_\n\n**`vi.stubGlobal` ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ¼ã‚Œ â€” ãƒ†ã‚¹ãƒˆæ±šæŸ“ã®ãƒªã‚¹ã‚¯**\n\n`vi.stubGlobal` ã§è¨­å®šã—ãŸã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¯ã€`unstubGlobals` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‹ `vi.unstubAllGlobals()` ã‚’å‘¼ã³å‡ºã•ãªã„é™ã‚Šã€ãƒ†ã‚¹ãƒˆé–“ã§è‡ªå‹•ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã›ã‚“ã€‚ `afterAll` ã® `vi.restoreAllMocks()` ã¯ `vi.spyOn` ãƒ¢ãƒƒã‚¯ã®ã¿ã‚’å¯¾è±¡ã¨ã—ã¦ãŠã‚Šã€`vi.stubGlobal` ã§å¤‰æ›´ã—ãŸã‚°ãƒ­ãƒ¼ãƒãƒ«å€¤ã¯ `vi.unstubAllGlobals()` ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§å…ƒã®å€¤ã«æˆ»ã™ã“ã¨ãŒã§ãã¾ã™ã€‚\n\nã“ã®ãŸã‚ã€`Worker` ã‚°ãƒ­ãƒ¼ãƒãƒ«ãŒ `MockWorker` ã®ã¾ã¾æ®‹ã‚Šã€å¾Œç¶šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«å½±éŸ¿ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n\n<details>\n<summary>ğŸ›¡ï¸ ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n   afterAll(() => {\n     vi.restoreAllMocks();\n+    vi.unstubAllGlobals();\n   });\n```\n</details>\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/adapter-gtp/src/__tests__/GTPAdapter.test.ts` around lines 46 - 56,\nThe tests stub the global Worker via vi.stubGlobal(MockWorker) in beforeEach but\nonly call vi.restoreAllMocks() in afterAll, leaving the global Worker overridden\nacross other tests; update cleanup to call vi.unstubAllGlobals() (or enable\nunstubGlobals option) in the teardown (e.g., in afterAll or afterEach) so the\nglobal set by vi.stubGlobal(\"Worker\", MockWorker) is restored to its original\nvalue and prevents test pollution.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:56:53Z",
    "updated_at": "2026-02-19T00:56:56Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140278",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140278"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140278"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140278/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 46,
    "original_start_line": 46,
    "start_side": "RIGHT",
    "line": 56,
    "original_line": 56,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 56,
    "position": 56,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140280",
    "pull_request_review_id": 3822948957,
    "id": 2825140280,
    "node_id": "PRRC_kwDORJ0gd86oZDg4",
    "diff_hunk": "@@ -210,4 +219,35 @@ export class EngineLoader implements IEngineLoader {\n       }\n     }\n   }\n+\n+  /**\n+   * 2026 Best Practice: Worker å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ã‚ªãƒªã‚¸ãƒ³æ¤œè¨¼\n+   */\n+  private validateWorkerUrl(url: string, engineId?: string): void {\n+    if (url.startsWith(\"blob:\")) return;\n+    try {\n+      const parsedUrl = new URL(url, window.location.href);\n+      const isLoopback =\n+        parsedUrl.hostname === \"localhost\" ||\n+        parsedUrl.hostname === \"127.0.0.1\" ||\n+        parsedUrl.hostname === \"::1\";\n+\n+      if (parsedUrl.origin !== window.location.origin && !isLoopback) {\n+        throw new EngineError({\n+          code: EngineErrorCode.SECURITY_ERROR,\n+          message: `Cross-origin Worker scripts are prohibited for security: ${url}`,\n+          engineId,\n+          remediation:\n+            \"Host the engine worker script on the same origin or use a Blob URL via EngineLoader.\",\n+        });\n+      }\n+    } catch (e) {\n+      if (e instanceof EngineError) throw e;\n+      throw new EngineError({\n+        code: EngineErrorCode.VALIDATION_ERROR,\n+        message: `Invalid resource URL: ${url}`,\n+        engineId,\n+      });\n+    }\n+  }",
    "path": "packages/core/src/bridge/EngineLoader.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "86a425c6cc0753096ae977794ede356639aab065",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸŸ¡ Minor_\n\n<details>\n<summary>ğŸ§© Analysis chain</summary>\n\nğŸ Script executed:\n\n```shell\ncd /tmp && find . -name \"EngineLoader.ts\" -type f 2>/dev/null | head -5\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 53\n\n---\n\nğŸ Script executed:\n\n```shell\ngit ls-files packages/core/src/bridge/ | grep -i engineloader\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 166\n\n---\n\nğŸ Script executed:\n\n```shell\ncat -n packages/core/src/bridge/EngineLoader.ts | head -100\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 4036\n\n---\n\nğŸ Script executed:\n\n```shell\ncat -n packages/core/src/bridge/EngineLoader.ts | sed -n '200,280p'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 1945\n\n---\n\nğŸ Script executed:\n\n```shell\ncat -n packages/core/src/bridge/EngineLoader.ts | sed -n '1,100p'\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 4036\n\n---\n\nğŸ Script executed:\n\n```shell\ncat -n packages/core/src/bridge/EngineLoader.security.test.ts\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 3375\n\n---\n\nğŸ Script executed:\n\n```shell\nrg -n \"loopback|localhost|production|validateWorkerUrl\" packages/core/src/bridge/ -A 3\n```\n\nRepository: hdkz-dev/multi-game-engines\n\nLength of output: 3830\n\n---\n\n\n\n</details>\n\n**ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ URL ã‹ã‚‰ã® Worker èª­ã¿è¾¼ã¿ã¯æœ¬ç•ªç’°å¢ƒã§ã‚‚è¨±å¯ã•ã‚Œã¦ã„ã¾ã™**\n\n`validateWorkerUrl` ã® `!isLoopback` æ¡ä»¶ï¼ˆLine 235ï¼‰ã«ã‚ˆã‚Šã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ`localhost`, `127.0.0.1` ç­‰ï¼‰ã¯ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ãƒã‚§ãƒƒã‚¯ã‚’å…é™¤ã•ã‚Œã¾ã™ã€‚ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆ`EngineLoader.security.test.ts:60-63`ï¼‰ã§ã€Œ`should allow exact localhost`ã€ã¨æ˜ç¤ºã•ã‚Œã¦ãŠã‚Šã€ã“ã®å‹•ä½œã¯æ„å›³çš„ãªè¨­è¨ˆã§ã™ã€‚\n\nã—ã‹ã—ã€`loadResource` ã§è¨ˆç®—ã•ã‚Œã‚‹ `isProduction` ãƒ•ãƒ©ã‚°ï¼ˆLine 72-74ï¼‰ãŒ `validateWorkerUrl` ã«ä¼é”ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€æœ¬ç•ªç’°å¢ƒã§ã®ç’°å¢ƒåˆ¥åˆ¶å¾¡ãŒä¸å¯èƒ½ã§ã™ã€‚ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€æœ¬ç•ªã® HTTPS ãƒšãƒ¼ã‚¸ï¼ˆä¾‹: `https://prod.example.com`ï¼‰ã‹ã‚‰ `http://localhost:8080/worker.js` ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚\n\nSRI æ¤œè¨¼ãŒå¿…é ˆï¼ˆLines 76-82ï¼‰ã§ã‚ã‚‹ãŸã‚å®Œå…¨ãªç©´ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã§ç•°ãªã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’é©ç”¨ã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®å¯¾å¿œãŒå¿…è¦ã§ã™ï¼š\n\n- æœ¬ç•ªç’°å¢ƒã§ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯èª­ã¿è¾¼ã¿ã‚’ç¦æ­¢ã™ã‚‹å ´åˆï¼š`isProduction` ã‚’ `validateWorkerUrl` ã«æ¸¡ã—ã€æœ¬ç•ªã§ã® localhost ã¯ã‚¨ãƒ©ãƒ¼ã«ã™ã‚‹\n- ã¾ãŸã¯æ˜ç¢ºãªè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã€Œãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯è¨±å¯ã¯é–‹ç™º/ãƒ†ã‚¹ãƒˆç’°å¢ƒå‘ã‘ã®ä»•æ§˜ã€ã¨è¨˜è¼‰ã—ã€æœ¬ç•ªã§ã®ä½¿ç”¨ã‚’ç¦æ­¢ã™ã‚‹æ—¨ã‚’æ˜è¨˜ã™ã‚‹\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/core/src/bridge/EngineLoader.ts` around lines 226 - 252, The\nvalidateWorkerUrl method currently treats loopback hosts as exempt from\ncross-origin checks; pass the environment flag from loadResource (the computed\nisProduction) into validateWorkerUrl and update its logic to reject loopback\nhosts when isProduction is true. Specifically, add an isProduction boolean\nparameter to validateWorkerUrl and, when isProduction === true, remove the\n!isLoopback bypass so that URLs with hostname localhost/127.0.0.1/::1 are\ntreated as cross-origin and cause an EngineError\n(EngineErrorCode.SECURITY_ERROR) similar to the existing non-origin branch; keep\nexisting behavior when isProduction is false to preserve tests that allow\nlocalhost. Ensure calls to validateWorkerUrl (e.g., from loadResource) are\nupdated to pass the isProduction value.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:56:53Z",
    "updated_at": "2026-02-19T00:56:56Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140280",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140280"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140280"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140280/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 226,
    "original_start_line": 226,
    "start_side": "RIGHT",
    "line": 252,
    "original_line": 252,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 109,
    "position": 109,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140285",
    "pull_request_review_id": 3822948957,
    "id": 2825140285,
    "node_id": "PRRC_kwDORJ0gd86oZDg9",
    "diff_hunk": "@@ -0,0 +1,104 @@\n+import { FEN, EngineErrorCode } from \"../../types.js\";\n+export { FEN };\n+import { EngineError } from \"../../errors/EngineError.js\";\n+\n+/**\n+ * ãƒã‚§ã‚¹å±€é¢æƒ…å ± (FEN) ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒªã€‚\n+ * ä¸ãˆã‚‰ã‚ŒãŸæ–‡å­—åˆ—ãŒæœ‰åŠ¹ãª FEN å½¢å¼ã§ã‚ã‚‹ã“ã¨ã‚’å³å¯†ã«æ¤œè¨¼ã—ã€Branded Type ã¨ã—ã¦è¿”ã—ã¾ã™ã€‚\n+ *\n+ * @param pos - æ¤œè¨¼å¯¾è±¡ã® FEN æ–‡å­—åˆ—ã€‚\n+ * @returns æ¤œè¨¼æ¸ˆã¿ã® FEN æ–‡å­—åˆ—ã€‚\n+ * @throws {EngineError} FEN ãŒç„¡åŠ¹ãªå ´åˆï¼ˆç©ºæ–‡å­—ã€ä¸æ­£ãªæ–‡å­—ã€æ§‹é€ ã‚¨ãƒ©ãƒ¼ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸æ­£ãªã©ï¼‰ã€‚\n+ *\n+ * ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜:\n+ * 1. ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯: ç©ºã§ãªã„ã“ã¨ã€‚\n+ * 2. æ–‡å­—ç¨®åˆ¶é™: [0-9], [a-z], [A-Z], '/', ' ', '-' ã®ã¿è¨±å¯ã€‚\n+ * 3. æ§‹é€ ãƒã‚§ãƒƒã‚¯: ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§æ­£ç¢ºã« 6 ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤ã“ã¨ã€‚\n+ * 4. é§’é…ç½® (Piece Placement): '/' åŒºåˆ‡ã‚Šã§ 8 ãƒ©ãƒ³ã‚¯ã‚ã‚‹ã“ã¨ã€‚å„ãƒ©ãƒ³ã‚¯ã¯ 1-8 ã¾ãŸã¯é§’æ–‡å­—ã®ã¿ã€‚\n+ * 5. æ‰‹ç•ª (Active Color): 'w' ã¾ãŸã¯ 'b'ã€‚\n+ * 6. ã‚­ãƒ£ã‚¹ãƒªãƒ³ã‚° (Castling): '-' ã¾ãŸã¯ 'KQkq' ã®çµ„ã¿åˆã‚ã›ã€‚\n+ * 7. ã‚¢ãƒ³ãƒ‘ãƒƒã‚µãƒ³ (En Passant): '-' ã¾ãŸã¯ä»£æ•°è¡¨è¨˜ã®ãƒã‚¹ï¼ˆä¾‹: 'e3'ï¼‰ã€‚\n+ * 8. æ‰‹æ•° (Move Counters): åŠæ‰‹æ•°ãƒ»å…¨æ‰‹æ•°ãŒæ•°å€¤ã§ã‚ã‚‹ã“ã¨ã€‚\n+ */\n+export function createFEN(pos: string): FEN {\n+  if (typeof pos !== \"string\" || pos.trim().length === 0) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: \"Invalid FEN: Input must be a non-empty string.\", // Key: engine.errors.invalidFEN\n+    });\n+  }\n+\n+  const trimmedPos = pos.trim();\n+\n+  // 2026 Best Practice: Character Whitelist Validation (Refuse by Exception)\n+  // FEN characters: digits 0-9, rnbqkpRNBQKP, 'w', slashes '/', spaces ' ', and '-'\n+  if (!/^[0-9rnbqkpRNBQKPw/\\s-]+$/.test(trimmedPos)) {\n+    throw new EngineError({\n+      code: EngineErrorCode.SECURITY_ERROR,\n+      message: \"Invalid FEN: Illegal characters detected.\", // Key: engine.errors.illegalCharacters\n+      remediation:\n+        \"FEN should only contain [0-9], [a-z], [A-Z], '/', ' ', and '-'.\",\n+    });\n+  }\n+\n+  const fields = trimmedPos.split(/\\s+/);\n+  if (fields.length !== 6) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid FEN structure: Expected 6 fields, found ${fields.length}`, // Key: engine.errors.invalidFENStructure\n+    });\n+  }\n+\n+  const [pieces, turn, castling, enPassant, halfMove, fullMove] = fields;\n+\n+  // 1. Piece placement\n+  const ranks = pieces!.split(\"/\");\n+  if (ranks.length !== 8) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: \"Invalid FEN: Piece placement must have exactly 8 ranks.\",\n+    });\n+  }\n+  for (const rank of ranks) {\n+    if (!/^[1-8rnbqkpRNBQKP]+$/.test(rank)) {\n+      throw new EngineError({\n+        code: EngineErrorCode.VALIDATION_ERROR,\n+        message: `Invalid characters in piece placement rank: \"${rank}\"`,\n+      });\n+    }\n+  }\n+\n+  // 2. Active color\n+  if (turn !== \"w\" && turn !== \"b\") {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid active color: \"${turn}\"`,\n+    });\n+  }\n+\n+  // 3. Castling rights\n+  if (!/^(-|[KQkq]+)$/.test(castling!)) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid castling rights: \"${castling}\"`,\n+    });\n+  }",
    "path": "packages/core/src/domains/chess/index.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "86a425c6cc0753096ae977794ede356639aab065",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸŸ¡ Minor_\n\n**ã‚­ãƒ£ã‚¹ãƒªãƒ³ã‚°æ­£è¦è¡¨ç¾ãŒé‡è¤‡æ–‡å­—ãƒ»ä¸æ­£ãªé †åºã‚’è¨±å¯ã—ã¾ã™ã€‚**\n\n`/^(-|[KQkq]+)$/` ã¯ `KKKK` ã‚„ `qKQk` ã®ã‚ˆã†ãªç„¡åŠ¹ãªæ–‡å­—åˆ—ã‚’é€šéã•ã›ã¾ã™ã€‚FEN ä»•æ§˜ã§ã¯å„æ–‡å­—ã¯æœ€å¤§ 1 å›ãƒ»`KQkq` ã®é †åºã§ç¾ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n<details>\n<summary>ğŸ› ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n-  if (!/^(-|[KQkq]+)$/.test(castling!)) {\n+  if (!/^(-|K?Q?k?q?)$/.test(castling!) || (castling !== \"-\" && castling!.length === 0)) {\n```\n</details>\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/core/src/domains/chess/index.ts` around lines 80 - 85, The current\nvalidation using /^(-|[KQkq]+)$/ allows duplicates and wrong order for the\ncastling string; update the validation around the castling variable used in this\ncheck to allow only \"-\" or a sequence that is a subset of \"KQkq\" in that exact\norder with no repeats (e.g., use a stricter pattern or explicit check), and keep\nthrowing EngineError with EngineErrorCode.VALIDATION_ERROR and the same message\nwhen it fails; locate the castling validation block (the if that throws\nEngineError) and replace the regex-based test with one that enforces K?Q?k?q?\nordering or an equivalent algorithm that ensures each of 'K','Q','k','q' appears\nat most once and in that order.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:56:54Z",
    "updated_at": "2026-02-19T00:56:56Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140285",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140285"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140285"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 80,
    "original_start_line": 80,
    "start_side": "RIGHT",
    "line": 85,
    "original_line": 85,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 85,
    "position": 85,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140288",
    "pull_request_review_id": 3822948957,
    "id": 2825140288,
    "node_id": "PRRC_kwDORJ0gd86oZDhA",
    "diff_hunk": "@@ -0,0 +1,104 @@\n+import { FEN, EngineErrorCode } from \"../../types.js\";\n+export { FEN };\n+import { EngineError } from \"../../errors/EngineError.js\";\n+\n+/**\n+ * ãƒã‚§ã‚¹å±€é¢æƒ…å ± (FEN) ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒªã€‚\n+ * ä¸ãˆã‚‰ã‚ŒãŸæ–‡å­—åˆ—ãŒæœ‰åŠ¹ãª FEN å½¢å¼ã§ã‚ã‚‹ã“ã¨ã‚’å³å¯†ã«æ¤œè¨¼ã—ã€Branded Type ã¨ã—ã¦è¿”ã—ã¾ã™ã€‚\n+ *\n+ * @param pos - æ¤œè¨¼å¯¾è±¡ã® FEN æ–‡å­—åˆ—ã€‚\n+ * @returns æ¤œè¨¼æ¸ˆã¿ã® FEN æ–‡å­—åˆ—ã€‚\n+ * @throws {EngineError} FEN ãŒç„¡åŠ¹ãªå ´åˆï¼ˆç©ºæ–‡å­—ã€ä¸æ­£ãªæ–‡å­—ã€æ§‹é€ ã‚¨ãƒ©ãƒ¼ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸æ­£ãªã©ï¼‰ã€‚\n+ *\n+ * ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜:\n+ * 1. ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯: ç©ºã§ãªã„ã“ã¨ã€‚\n+ * 2. æ–‡å­—ç¨®åˆ¶é™: [0-9], [a-z], [A-Z], '/', ' ', '-' ã®ã¿è¨±å¯ã€‚\n+ * 3. æ§‹é€ ãƒã‚§ãƒƒã‚¯: ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§æ­£ç¢ºã« 6 ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤ã“ã¨ã€‚\n+ * 4. é§’é…ç½® (Piece Placement): '/' åŒºåˆ‡ã‚Šã§ 8 ãƒ©ãƒ³ã‚¯ã‚ã‚‹ã“ã¨ã€‚å„ãƒ©ãƒ³ã‚¯ã¯ 1-8 ã¾ãŸã¯é§’æ–‡å­—ã®ã¿ã€‚\n+ * 5. æ‰‹ç•ª (Active Color): 'w' ã¾ãŸã¯ 'b'ã€‚\n+ * 6. ã‚­ãƒ£ã‚¹ãƒªãƒ³ã‚° (Castling): '-' ã¾ãŸã¯ 'KQkq' ã®çµ„ã¿åˆã‚ã›ã€‚\n+ * 7. ã‚¢ãƒ³ãƒ‘ãƒƒã‚µãƒ³ (En Passant): '-' ã¾ãŸã¯ä»£æ•°è¡¨è¨˜ã®ãƒã‚¹ï¼ˆä¾‹: 'e3'ï¼‰ã€‚\n+ * 8. æ‰‹æ•° (Move Counters): åŠæ‰‹æ•°ãƒ»å…¨æ‰‹æ•°ãŒæ•°å€¤ã§ã‚ã‚‹ã“ã¨ã€‚\n+ */\n+export function createFEN(pos: string): FEN {\n+  if (typeof pos !== \"string\" || pos.trim().length === 0) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: \"Invalid FEN: Input must be a non-empty string.\", // Key: engine.errors.invalidFEN\n+    });\n+  }\n+\n+  const trimmedPos = pos.trim();\n+\n+  // 2026 Best Practice: Character Whitelist Validation (Refuse by Exception)\n+  // FEN characters: digits 0-9, rnbqkpRNBQKP, 'w', slashes '/', spaces ' ', and '-'\n+  if (!/^[0-9rnbqkpRNBQKPw/\\s-]+$/.test(trimmedPos)) {\n+    throw new EngineError({\n+      code: EngineErrorCode.SECURITY_ERROR,\n+      message: \"Invalid FEN: Illegal characters detected.\", // Key: engine.errors.illegalCharacters\n+      remediation:\n+        \"FEN should only contain [0-9], [a-z], [A-Z], '/', ' ', and '-'.\",\n+    });\n+  }\n+\n+  const fields = trimmedPos.split(/\\s+/);\n+  if (fields.length !== 6) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid FEN structure: Expected 6 fields, found ${fields.length}`, // Key: engine.errors.invalidFENStructure\n+    });\n+  }\n+\n+  const [pieces, turn, castling, enPassant, halfMove, fullMove] = fields;\n+\n+  // 1. Piece placement\n+  const ranks = pieces!.split(\"/\");\n+  if (ranks.length !== 8) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: \"Invalid FEN: Piece placement must have exactly 8 ranks.\",\n+    });\n+  }\n+  for (const rank of ranks) {\n+    if (!/^[1-8rnbqkpRNBQKP]+$/.test(rank)) {\n+      throw new EngineError({\n+        code: EngineErrorCode.VALIDATION_ERROR,\n+        message: `Invalid characters in piece placement rank: \"${rank}\"`,\n+      });\n+    }\n+  }\n+\n+  // 2. Active color\n+  if (turn !== \"w\" && turn !== \"b\") {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid active color: \"${turn}\"`,\n+    });\n+  }\n+\n+  // 3. Castling rights\n+  if (!/^(-|[KQkq]+)$/.test(castling!)) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid castling rights: \"${castling}\"`,\n+    });\n+  }\n+\n+  // 4. En passant\n+  if (!/^(-|[a-h][36])$/.test(enPassant!)) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid en passant square: \"${enPassant}\"`,\n+    });\n+  }\n+\n+  // 5 & 6. Move counters\n+  if (isNaN(Number(halfMove)) || isNaN(Number(fullMove))) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: \"Invalid move counters: must be numeric.\",\n+    });\n+  }",
    "path": "packages/core/src/domains/chess/index.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "86a425c6cc0753096ae977794ede356639aab065",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸŸ¡ Minor_\n\n**æ‰‹æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤åŸŸãƒã‚§ãƒƒã‚¯ãŒä¸å®Œå…¨ã§ã™ã€‚**\n\n`isNaN(Number(...))` ã®ã¿ã§ã¯è² ã®å€¤ï¼ˆ`-1` ç­‰ï¼‰ãŒé€šéã—ã¾ã™ã€‚FEN ä»•æ§˜ã§ã¯åŠæ‰‹æ•°ã‚¯ãƒ­ãƒƒã‚¯ï¼ˆ`halfMove`ï¼‰ã¯ `>= 0`ã€å…¨æ‰‹æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆ`fullMove`ï¼‰ã¯ `>= 1` ã§ã‚ã‚‹ã¹ãã§ã™ã€‚\n\n<details>\n<summary>ğŸ› ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n-  if (isNaN(Number(halfMove)) || isNaN(Number(fullMove))) {\n+  const halfMoveNum = Number(halfMove);\n+  const fullMoveNum = Number(fullMove);\n+  if (\n+    !Number.isInteger(halfMoveNum) || halfMoveNum < 0 ||\n+    !Number.isInteger(fullMoveNum) || fullMoveNum < 1\n+  ) {\n     throw new EngineError({\n       code: EngineErrorCode.VALIDATION_ERROR,\n       message: \"Invalid move counters: must be numeric.\",\n     });\n   }\n```\n</details>\n\n<!-- suggestion_start -->\n\n<details>\n<summary>ğŸ“ Committable suggestion</summary>\n\n> â€¼ï¸ **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n  const halfMoveNum = Number(halfMove);\n  const fullMoveNum = Number(fullMove);\n  if (\n    !Number.isInteger(halfMoveNum) || halfMoveNum < 0 ||\n    !Number.isInteger(fullMoveNum) || fullMoveNum < 1\n  ) {\n    throw new EngineError({\n      code: EngineErrorCode.VALIDATION_ERROR,\n      message: \"Invalid move counters: must be numeric.\",\n    });\n  }\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/core/src/domains/chess/index.ts` around lines 96 - 101, The current\nvalidation using isNaN(Number(halfMove)) / isNaN(Number(fullMove)) lets negative\nand non-integer values slip through; update the check around the\nhalfMove/fullMove validation (the block that throws EngineError with\nEngineErrorCode.VALIDATION_ERROR) to ensure both are numeric integers and within\nFEN bounds: halfMove must be >= 0 and fullMove must be >= 1 (and you may also\nenforce integer-ness via Number.isInteger or equivalent after coercion). If the\ncheck fails, keep throwing an EngineError with a clear message mentioning the\nrequired ranges for halfMove (>=0) and fullMove (>=1).\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:56:54Z",
    "updated_at": "2026-02-19T00:56:56Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140288",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140288"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140288"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 96,
    "original_start_line": 96,
    "start_side": "RIGHT",
    "line": 101,
    "original_line": 101,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 101,
    "position": 101,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140289",
    "pull_request_review_id": 3822948957,
    "id": 2825140289,
    "node_id": "PRRC_kwDORJ0gd86oZDhB",
    "diff_hunk": "@@ -0,0 +1,87 @@\n+import { SFEN, EngineErrorCode } from \"../../types.js\";\n+export { SFEN };\n+import { EngineError } from \"../../errors/EngineError.js\";\n+\n+/**\n+ * å°†æ£‹å±€é¢æƒ…å ± (SFEN) ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒªã€‚\n+ * ä¸ãˆã‚‰ã‚ŒãŸæ–‡å­—åˆ—ãŒæœ‰åŠ¹ãª SFEN å½¢å¼ã§ã‚ã‚‹ã“ã¨ã‚’å³å¯†ã«æ¤œè¨¼ã—ã€Branded Type ã¨ã—ã¦è¿”ã—ã¾ã™ã€‚\n+ *\n+ * @param pos - æ¤œè¨¼å¯¾è±¡ã® SFEN æ–‡å­—åˆ—ã€‚\n+ * @returns æ¤œè¨¼æ¸ˆã¿ã® SFEN æ–‡å­—åˆ—ã€‚\n+ * @throws {EngineError} SFEN ãŒç„¡åŠ¹ãªå ´åˆã€‚\n+ *\n+ * ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜:\n+ * 1. ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯ã€‚\n+ * 2. æ–‡å­—ç¨®åˆ¶é™: [0-9], [a-z], [A-Z], '+', '/', ' ', '-' ã®ã¿è¨±å¯ã€‚\n+ * 3. æ§‹é€ ãƒã‚§ãƒƒã‚¯: ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§ 4 ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤ã“ã¨ã€‚\n+ * 4. ç›¤é¢é…ç½®: '/' åŒºåˆ‡ã‚Šã§ 9 ãƒ©ãƒ³ã‚¯ã‚ã‚‹ã“ã¨ã€‚\n+ * 5. æ‰‹ç•ª: 'b' (å…ˆæ‰‹) ã¾ãŸã¯ 'w' (å¾Œæ‰‹)ã€‚\n+ * 6. æŒã¡é§’: '-' ã¾ãŸã¯æœ‰åŠ¹ãªé§’æ–‡å­—åˆ—ã€‚\n+ * 7. æ‰‹æ•°: æ•°å€¤ã§ã‚ã‚‹ã“ã¨ã€‚\n+ */\n+export function createSFEN(pos: string): SFEN {\n+  if (typeof pos !== \"string\" || pos.trim().length === 0) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: \"Invalid SFEN: Input must be a non-empty string.\",\n+    });\n+  }\n+\n+  const trimmedPos = pos.trim();\n+\n+  // 2026 Best Practice: Refuse by Exception character validation\n+  // SFEN allowed characters: [0-9], [a-z], [A-Z], '/', '+', ' ', and '-'\n+  if (!/^[0-9a-zA-Z/+\\s-]+$/.test(trimmedPos)) {\n+    throw new EngineError({\n+      code: EngineErrorCode.SECURITY_ERROR,\n+      message: \"Invalid SFEN: Illegal characters detected.\",\n+      remediation:\n+        \"SFEN should only contain [0-9], [a-z], [A-Z], '+', '/', ' ', and '-'.\",\n+    });\n+  }\n+\n+  const fields = trimmedPos.split(/\\s+/);\n+  if (fields.length < 4) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid SFEN structure: Expected 4 fields, found ${fields.length}`,\n+    });\n+  }",
    "path": "packages/core/src/domains/shogi/index.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "86a425c6cc0753096ae977794ede356639aab065",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸŸ¡ Minor_\n\n**`fields.length < 4` ã¯ä½™å‰°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤ä¸æ­£ãª SFEN ã‚’é€šéã•ã›ã¾ã™ã€‚**\n\nSFEN ã¯ FEN ã‚’å°†æ£‹ç”¨ã«æ‹¡å¼µã—ãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã€ã‚­ãƒ£ã‚¹ãƒªãƒ³ã‚°ãƒ»ã‚¢ãƒ³ãƒ‘ãƒƒã‚µãƒ³ãƒ»åŠæ‰‹æ•°ã‚¯ãƒ­ãƒƒã‚¯ã®ä»£ã‚ã‚Šã«æŒã¡é§’ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¿½åŠ ã•ã‚ŒãŸã€æ­£ç¢ºã« **4 ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰** ã®æ§‹é€ ã§ã™ã€‚`< 4` ã§ã¯ 5 ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä»¥ä¸Šã®å…¥åŠ›ãŒæ¤œè¨¼ã‚’ãƒ‘ã‚¹ã—ã€ä½™å‰°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚µã‚¤ãƒ¬ãƒ³ãƒˆã«ç„¡è¦–ã•ã‚Œã¾ã™ã€‚`!== 4` ã«ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚\n\n<details>\n<summary>ğŸ› ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n-  if (fields.length < 4) {\n+  if (fields.length !== 4) {\n     throw new EngineError({\n       code: EngineErrorCode.VALIDATION_ERROR,\n-      message: `Invalid SFEN structure: Expected 4 fields, found ${fields.length}`,\n+      message: `Invalid SFEN structure: Expected exactly 4 fields, found ${fields.length}`,\n     });\n   }\n```\n</details>\n\n<!-- suggestion_start -->\n\n<details>\n<summary>ğŸ“ Committable suggestion</summary>\n\n> â€¼ï¸ **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n  const fields = trimmedPos.split(/\\s+/);\n  if (fields.length !== 4) {\n    throw new EngineError({\n      code: EngineErrorCode.VALIDATION_ERROR,\n      message: `Invalid SFEN structure: Expected exactly 4 fields, found ${fields.length}`,\n    });\n  }\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/core/src/domains/shogi/index.ts` around lines 43 - 49, The SFEN\nvalidation currently accepts inputs with extra fields because it checks\n\"fields.length < 4\"; change this to require exactly four fields by checking\n\"fields.length !== 4\". Update the validation around trimmedPos and fields so\nthat when fields length is not exactly 4 you throw the existing EngineError\nusing EngineErrorCode.VALIDATION_ERROR and the same message (adjusting the\nphrase to say \"Expected exactly 4 fields\" if you prefer) to ensure inputs with\n5+ fields are rejected.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:56:54Z",
    "updated_at": "2026-02-19T00:56:56Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140289",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140289"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140289"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140289/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 43,
    "original_start_line": 43,
    "start_side": "RIGHT",
    "line": 49,
    "original_line": 49,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 49,
    "position": 49,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140291",
    "pull_request_review_id": 3822948957,
    "id": 2825140291,
    "node_id": "PRRC_kwDORJ0gd86oZDhD",
    "diff_hunk": "@@ -0,0 +1,87 @@\n+import { SFEN, EngineErrorCode } from \"../../types.js\";\n+export { SFEN };\n+import { EngineError } from \"../../errors/EngineError.js\";\n+\n+/**\n+ * å°†æ£‹å±€é¢æƒ…å ± (SFEN) ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¯ãƒˆãƒªã€‚\n+ * ä¸ãˆã‚‰ã‚ŒãŸæ–‡å­—åˆ—ãŒæœ‰åŠ¹ãª SFEN å½¢å¼ã§ã‚ã‚‹ã“ã¨ã‚’å³å¯†ã«æ¤œè¨¼ã—ã€Branded Type ã¨ã—ã¦è¿”ã—ã¾ã™ã€‚\n+ *\n+ * @param pos - æ¤œè¨¼å¯¾è±¡ã® SFEN æ–‡å­—åˆ—ã€‚\n+ * @returns æ¤œè¨¼æ¸ˆã¿ã® SFEN æ–‡å­—åˆ—ã€‚\n+ * @throws {EngineError} SFEN ãŒç„¡åŠ¹ãªå ´åˆã€‚\n+ *\n+ * ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜:\n+ * 1. ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯ã€‚\n+ * 2. æ–‡å­—ç¨®åˆ¶é™: [0-9], [a-z], [A-Z], '+', '/', ' ', '-' ã®ã¿è¨±å¯ã€‚\n+ * 3. æ§‹é€ ãƒã‚§ãƒƒã‚¯: ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§ 4 ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤ã“ã¨ã€‚\n+ * 4. ç›¤é¢é…ç½®: '/' åŒºåˆ‡ã‚Šã§ 9 ãƒ©ãƒ³ã‚¯ã‚ã‚‹ã“ã¨ã€‚\n+ * 5. æ‰‹ç•ª: 'b' (å…ˆæ‰‹) ã¾ãŸã¯ 'w' (å¾Œæ‰‹)ã€‚\n+ * 6. æŒã¡é§’: '-' ã¾ãŸã¯æœ‰åŠ¹ãªé§’æ–‡å­—åˆ—ã€‚\n+ * 7. æ‰‹æ•°: æ•°å€¤ã§ã‚ã‚‹ã“ã¨ã€‚\n+ */\n+export function createSFEN(pos: string): SFEN {\n+  if (typeof pos !== \"string\" || pos.trim().length === 0) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: \"Invalid SFEN: Input must be a non-empty string.\",\n+    });\n+  }\n+\n+  const trimmedPos = pos.trim();\n+\n+  // 2026 Best Practice: Refuse by Exception character validation\n+  // SFEN allowed characters: [0-9], [a-z], [A-Z], '/', '+', ' ', and '-'\n+  if (!/^[0-9a-zA-Z/+\\s-]+$/.test(trimmedPos)) {\n+    throw new EngineError({\n+      code: EngineErrorCode.SECURITY_ERROR,\n+      message: \"Invalid SFEN: Illegal characters detected.\",\n+      remediation:\n+        \"SFEN should only contain [0-9], [a-z], [A-Z], '+', '/', ' ', and '-'.\",\n+    });\n+  }\n+\n+  const fields = trimmedPos.split(/\\s+/);\n+  if (fields.length < 4) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid SFEN structure: Expected 4 fields, found ${fields.length}`,\n+    });\n+  }\n+\n+  const [board, turn, hand, moveCount] = fields;\n+\n+  // 1. Board placement (9 ranks)\n+  const ranks = board!.split(\"/\");\n+  if (ranks.length !== 9) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid board structure: Expected 9 ranks, found ${ranks.length}`,\n+    });\n+  }\n+\n+  // 2. Active color\n+  if (turn !== \"b\" && turn !== \"w\") {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid turn indicator: \"${turn}\" (expected \"b\" or \"w\")`,\n+    });\n+  }\n+\n+  // 3. Hand pieces\n+  if (hand !== \"-\" && !/^[0-9a-zA-Z]+$/.test(hand!)) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid hand pieces: \"${hand}\"`,\n+    });\n+  }\n+\n+  // 4. Move count\n+  if (isNaN(Number(moveCount))) {\n+    throw new EngineError({\n+      code: EngineErrorCode.VALIDATION_ERROR,\n+      message: `Invalid move count: \"${moveCount}\"`,\n+    });\n+  }",
    "path": "packages/core/src/domains/shogi/index.ts",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "86a425c6cc0753096ae977794ede356639aab065",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸŸ¡ Minor_\n\n**æ‰‹æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« 0 ä»¥ä¸‹ã®å€¤ãŒé€šéã—ã¾ã™ã€‚**\n\n`Move count` ã¯ç¾åœ¨ã®æ‰‹æ•°ã‚’è¡¨ã™æ•´æ•°ã§ã‚ã‚Šã€USI ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã¯å›½éš›çš„ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã€Œãƒ—ãƒ©ã‚¤ã€ã¾ãŸã¯ã€ŒåŠæ‰‹ã€ã¨å‘¼ã¶å˜ä½ã§ã‚«ã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚ åˆæœŸå±€é¢ã®æ¨™æº– SFEN ä¾‹ã§ã¯æ‰‹æ•°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ `1` ã§ã™ã€‚\n\n`isNaN(Number(moveCount))` ã®ã¿ã§ã¯ `0` ã‚„ `-1` ã®ã‚ˆã†ãªä¸æ­£å€¤ãŒé€šéã—ã¾ã™ã€‚`>= 1` ã®æ•´æ•°ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚\n\n<details>\n<summary>ğŸ› ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n-  if (isNaN(Number(moveCount))) {\n+  const moveNum = Number(moveCount);\n+  if (!Number.isInteger(moveNum) || moveNum < 1) {\n     throw new EngineError({\n       code: EngineErrorCode.VALIDATION_ERROR,\n       message: `Invalid move count: \"${moveCount}\"`,\n     });\n   }\n```\n</details>\n\n<!-- suggestion_start -->\n\n<details>\n<summary>ğŸ“ Committable suggestion</summary>\n\n> â€¼ï¸ **IMPORTANT**\n> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.\n\n```suggestion\n  const moveNum = Number(moveCount);\n  if (!Number.isInteger(moveNum) || moveNum < 1) {\n    throw new EngineError({\n      code: EngineErrorCode.VALIDATION_ERROR,\n      message: `Invalid move count: \"${moveCount}\"`,\n    });\n  }\n```\n\n</details>\n\n<!-- suggestion_end -->\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@packages/core/src/domains/shogi/index.ts` around lines 79 - 84, The current\nvalidation only checks isNaN(Number(moveCount)) and allows 0 or negative values;\nupdate the check for moveCount to parse it as a number (e.g., Number or\nparseInt), verify Number.isInteger(parsed) and parsed >= 1, and if the check\nfails throw the same EngineError with EngineErrorCode.VALIDATION_ERROR and\nmessage `Invalid move count: \"${moveCount}\"`; modify the validation surrounding\nmoveCount (the block that currently constructs the EngineError) to enforce the\n>= 1 integer requirement.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:poseidon:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:56:54Z",
    "updated_at": "2026-02-19T00:56:56Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140291",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140291"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140291"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 79,
    "original_start_line": 79,
    "start_side": "RIGHT",
    "line": 84,
    "original_line": 84,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 84,
    "position": 84,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140292",
    "pull_request_review_id": 3822948957,
    "id": 2825140292,
    "node_id": "PRRC_kwDORJ0gd86oZDhE",
    "diff_hunk": "@@ -56,7 +56,12 @@ engine.onInfo((info) => {\n });\n \n // æ¢ç´¢ã®å®Ÿè¡Œ (startpos ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚‚ã‚µãƒãƒ¼ãƒˆ)\n-const result = await engine.search({ fen: \"startpos\" as FEN });\n+import { createFEN } from \"@multi-game-engines/core/chess\";\n+\n+// ...\n+\n+const fen = createFEN(\"startpos\");\n+const result = await engine.search({ fen });",
    "path": "README.md",
    "commit_id": "46105e5ce60f814e430155c9b2d2a38233539c52",
    "original_commit_id": "86a425c6cc0753096ae977794ede356639aab065",
    "user": {
      "login": "coderabbitai[bot]",
      "id": 136622811,
      "node_id": "BOT_kgDOCCSy2w",
      "avatar_url": "https://avatars.githubusercontent.com/in/347564?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coderabbitai%5Bbot%5D",
      "html_url": "https://github.com/apps/coderabbitai",
      "followers_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coderabbitai%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "_âš ï¸ Potential issue_ | _ğŸŸ¡ Minor_\n\n**`import` æ–‡ãŒå®Ÿè¡Œã‚³ãƒ¼ãƒ‰ã®å¾Œã«é…ç½®ã•ã‚Œã¦ãŠã‚Šã€ç„¡åŠ¹ãª TypeScript ã§ã™**\n\nè¡Œ 59 ã® `import { createFEN }` ã¯ `bridge.registerAdapter()`ã€`engine.load()`ã€`engine.onInfo()` ã¨ã„ã£ãŸå®Ÿè¡Œæ–‡ã‚ˆã‚Šå¾Œã«ç½®ã‹ã‚Œã¦ã„ã¾ã™ã€‚TypeScript (ãŠã‚ˆã³ ESM) ã§ã¯ `import` å®£è¨€ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€å®Ÿè¡Œæ–‡ã®å¾Œã«è¨˜è¿°ã™ã‚‹ã¨ `An import declaration can only be used at the top level of a module` ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ã“ã®ã¾ã¾ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å³åº§ã«ã‚¨ãƒ©ãƒ¼ã«é­é‡ã—ã¾ã™ã€‚`createFEN` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’è¡Œ 42ã€œ43 ã®æ—¢å­˜ã‚¤ãƒ³ãƒãƒ¼ãƒˆç¾¤ã®ç›´å¾Œã«ç§»å‹•ã—ã¦ãã ã•ã„ã€‚\n\n\n\n<details>\n<summary>ğŸ“ ä¿®æ­£æ¡ˆ</summary>\n\n```diff\n import { EngineBridge } from \"@multi-game-engines/core\";\n import { StockfishAdapter, FEN } from \"@multi-game-engines/adapter-stockfish\";\n+import { createFEN } from \"@multi-game-engines/core/chess\";\n\n const bridge = new EngineBridge();\n // registerAdapter ã¯éåŒæœŸãƒ¡ã‚½ãƒƒãƒ‰ã§ã™\n await bridge.registerAdapter(new StockfishAdapter());\n\n // ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã‚Œã°ã€EngineRegistry ã«ã‚ˆã‚Šå‹æ¨è«–ãŒè‡ªå‹•çš„ã«åƒãã¾ã™\n const engine = bridge.getEngine(\"stockfish\");\n await engine.load();\n\n // æ€è€ƒçŠ¶æ³ã®è³¼èª­ (ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼å›ºæœ‰ã®å‹ãŒé©ç”¨ã•ã‚Œã¾ã™)\n engine.onInfo((info) => {\n   console.log(`Depth: ${info.depth}, Score: ${info.score}`);\n });\n\n // æ¢ç´¢ã®å®Ÿè¡Œ (startpos ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚‚ã‚µãƒãƒ¼ãƒˆ)\n-import { createFEN } from \"@multi-game-engines/core/chess\";\n-\n-// ...\n-\n const fen = createFEN(\"startpos\");\n const result = await engine.search({ fen });\n console.log(`Best Move: ${result.bestMove}`);\n```\n</details>\n\n<details>\n<summary>ğŸ¤– Prompt for AI Agents</summary>\n\n```\nVerify each finding against the current code and only fix it if needed.\n\nIn `@README.md` around lines 59 - 64, The import declaration for createFEN is\nplaced after executable statements (bridge.registerAdapter, engine.load,\nengine.onInfo), which is invalid in TypeScript/ESM; move the line \"import {\ncreateFEN } from '@multi-game-engines/core/chess';\" into the top-level import\nblock together with the existing imports (i.e. immediately after the other\nimport statements) so createFEN is declared before any runtime code like\nbridge.registerAdapter, engine.load, or engine.onInfo.\n```\n\n</details>\n\n<!-- fingerprinting:phantom:triton:churro -->\n\n<!-- This is an auto-generated comment by CodeRabbit -->",
    "created_at": "2026-02-19T00:56:54Z",
    "updated_at": "2026-02-19T00:56:56Z",
    "html_url": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140292",
    "pull_request_url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140292"
      },
      "html": {
        "href": "https://github.com/hdkz-dev/multi-game-engines/pull/25#discussion_r2825140292"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/25"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/hdkz-dev/multi-game-engines/pulls/comments/2825140292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 59,
    "original_start_line": 59,
    "start_side": "RIGHT",
    "line": 64,
    "original_line": 64,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 10,
    "position": 10,
    "subject_type": "line"
  }
]
